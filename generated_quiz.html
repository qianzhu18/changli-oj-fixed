<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>刷题系统</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .correct {
            background-color: rgba(0, 255, 0, 0.2);
            border-color: green;
            color: green;
        }

        .incorrect {
            background-color: rgba(255, 0, 0, 0.2);
            border-color: red;
            color: red;
        }

        .selected {
            border-width: 2px;
            border-color: blue;
        }
    </style>
</head>

<body class="bg-gray-100">
    <div class="container mx-auto p-4">
        <h1 class="text-2xl font-bold mb-4 text-center">刷题系统</h1>

        <div id="question-container" class="bg-white rounded-lg shadow-md p-4 mb-4">
            <!-- Question content will be dynamically inserted here -->
        </div>

        <div id="navigation" class="flex justify-between items-center mb-4">
            <button id="prev-btn" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded disabled:opacity-50 disabled:cursor-not-allowed">上一题</button>
            <button id="next-btn" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded disabled:opacity-50 disabled:cursor-not-allowed">下一题</button>
        </div>

        <div id="question-numbers" class="flex overflow-x-auto space-x-2 mb-4">
            <!-- Question number buttons will be dynamically inserted here -->
        </div>

        <div id="result" class="text-center font-bold text-lg hidden">
            <!-- Result will be displayed here -->
        </div>

        <div id="actions" class="text-center">
            <button id="complete-btn" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded hidden">完成</button>
            <button id="restart-btn" class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded hidden">重新开始</button>
        </div>
    </div>

    <script>
        const questions = [
            {
                question: "测试题目？",
                options: ["选项A", "选项B"],
                answer: "选项A"
            }
        ];

        let currentQuestionIndex = 0;
        let userAnswers = new Array(questions.length).fill(null);
        let questionOrder = Array.from(Array(questions.length).keys());  // 题目顺序
        let mode = '顺序'; // 默认为顺序模式

        // 函数：打乱题目顺序
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        //初始化题目顺序
        if(mode === '随机'){
            shuffleArray(questionOrder);
        }

        const questionContainer = document.getElementById("question-container");
        const prevBtn = document.getElementById("prev-btn");
        const nextBtn = document.getElementById("next-btn");
        const questionNumbersContainer = document.getElementById("question-numbers");
        const resultDiv = document.getElementById("result");
        const completeBtn = document.getElementById("complete-btn");
        const restartBtn = document.getElementById("restart-btn");

        // 函数：渲染题目
        function renderQuestion() {
            const questionIndex = questionOrder[currentQuestionIndex];
            const question = questions[questionIndex];
            questionContainer.innerHTML = "";

            const questionTitle = document.createElement("h2");
            questionTitle.className = "text-xl font-semibold mb-2";
            questionTitle.textContent = `题目 ${currentQuestionIndex + 1}: ${question.question}`;
            questionContainer.appendChild(questionTitle);

            // 检测题目类型：填空题还是选择题
            if (question.options) {
                // 选择题
                const optionsList = document.createElement("div");
                optionsList.className = "space-y-2";
                question.options.forEach((option, index) => {
                    const optionButton = document.createElement("button");
                    optionButton.className = `block w-full text-left border rounded py-2 px-4 hover:bg-gray-200 focus:outline-none ${userAnswers[questionIndex] === option ? 'selected' : ''}`;
                    optionButton.textContent = String.fromCharCode(65 + index) + ". " + option; // A. 选项A
                    optionButton.disabled = userAnswers[questionIndex] !== null; // 作答后锁定

                    if (userAnswers[questionIndex] !== null) {
                        // 已作答，显示对错
                        if (option === question.answer) {
                            optionButton.classList.add("correct");
                        } else if (userAnswers[questionIndex] === option) {
                            optionButton.classList.add("incorrect");
                        }
                    }

                    optionButton.addEventListener("click", () => {
                        if (userAnswers[questionIndex] === null) {
                            userAnswers[questionIndex] = option;
                            renderQuestion(); // 重新渲染，显示对错
                            updateQuestionNumberStyles();
                        }
                    });
                    optionsList.appendChild(optionButton);
                });
                questionContainer.appendChild(optionsList);
            } else {
                // 填空题
                const inputField = document.createElement("input");
                inputField.type = "text";
                inputField.className = `w-full border rounded py-2 px-4 ${userAnswers[questionIndex] !== null ? (userAnswers[questionIndex] === question.answer ? 'correct' : 'incorrect') : ''}`;
                inputField.placeholder = "请输入答案";
                inputField.value = userAnswers[questionIndex] || ""; // 显示已填写的答案
                inputField.disabled = userAnswers[questionIndex] !== null; // 作答后锁定

                questionContainer.appendChild(inputField);

                const submitButton = document.createElement("button");
                submitButton.textContent = "提交";
                submitButton.className = "bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded mt-2";
                submitButton.disabled = userAnswers[questionIndex] !== null; // 作答后锁定

                submitButton.addEventListener("click", () => {
                    if (userAnswers[questionIndex] === null) {
                        userAnswers[questionIndex] = inputField.value;
                        renderQuestion();
                        updateQuestionNumberStyles();
                    }
                });

                questionContainer.appendChild(submitButton);

                // 显示正确答案（如果错误）
                if (userAnswers[questionIndex] !== null && userAnswers[questionIndex] !== question.answer) {
                    const correctAnswer = document.createElement("p");
                    correctAnswer.className = "text-green-600 mt-2";
                    correctAnswer.textContent = `正确答案：${question.answer}`;
                    questionContainer.appendChild(correctAnswer);
                }
            }

            // 更新按钮状态
            prevBtn.disabled = currentQuestionIndex === 0;
            nextBtn.disabled = currentQuestionIndex === questions.length - 1;
        }

        // 函数：更新题号按钮样式
        function updateQuestionNumberStyles() {
            const buttons = questionNumbersContainer.querySelectorAll("button");
            buttons.forEach((button, index) => {
                const questionIndex = questionOrder[index];  // 获取实际题目的 index
                button.classList.remove("bg-blue-500", "bg-green-500", "bg-red-500", "text-white");
                button.classList.add("bg-gray-300");
                button.classList.remove("text-blue-600", "text-green-600", "text-red-600");

                if (index === currentQuestionIndex) {
                    button.classList.add("bg-blue-500", "text-white");
                } else if (userAnswers[questionIndex] !== null) {
                    const isCorrect = (questions[questionIndex].options) ? userAnswers[questionIndex] === questions[questionIndex].answer : userAnswers[questionIndex] === questions[questionIndex].answer;

                    if (isCorrect) {
                        button.classList.add("bg-green-500", "text-white");
                    } else {
                        button.classList.add("bg-red-500", "text-white");
                    }
                }
            });
        }

        // 函数：创建题号导航按钮
        function createQuestionNumberButtons() {
            questionNumbersContainer.innerHTML = "";
            for (let i = 0; i < questions.length; i++) {
                const button = document.createElement("button");
                button.textContent = i + 1;
                button.className = "rounded-full w-8 h-8 flex items-center justify-center";

                button.addEventListener("click", () => {
                    currentQuestionIndex = i;
                    renderQuestion();
                    updateQuestionNumberStyles();
                });
                questionNumbersContainer.appendChild(button);
            }
        }

        // 函数：计算得分
        function calculateScore() {
            let correctCount = 0;
            for (let i = 0; i < questions.length; i++) {
                const questionIndex = questionOrder[i];
                const isCorrect = (questions[questionIndex].options) ? userAnswers[questionIndex] === questions[questionIndex].answer : userAnswers[questionIndex] === questions[questionIndex].answer;
                if (isCorrect) {
                    correctCount++;
                }
            }
            return correctCount;
        }

        // 初始化
        createQuestionNumberButtons();
        renderQuestion();
        updateQuestionNumberStyles();

        // 导航
        prevBtn.addEventListener("click", () => {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                renderQuestion();
                updateQuestionNumberStyles();
            }
        });

        nextBtn.addEventListener("click", () => {
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                renderQuestion();
                updateQuestionNumberStyles();
            }
        });

        // 完成按钮
        completeBtn.addEventListener("click", () => {
            const correctCount = calculateScore();
            const percentage = (correctCount / questions.length) * 100;
            resultDiv.textContent = `得分: ${correctCount} / ${questions.length}  (正确率: ${percentage.toFixed(2)}%)`;
            resultDiv.classList.remove("hidden");
            completeBtn.classList.add("hidden");
            restartBtn.classList.remove("hidden");
            prevBtn.disabled = true;
            nextBtn.disabled = true;
            questionNumbersContainer.querySelectorAll("button").forEach(button => button.disabled = true);
        });

        // 重新开始按钮
        restartBtn.addEventListener("click", () => {
            currentQuestionIndex = 0;
            userAnswers = new Array(questions.length).fill(null);
            resultDiv.classList.add("hidden");
            completeBtn.classList.remove("hidden");
            restartBtn.classList.add("hidden");

            if(mode === '随机'){
                 shuffleArray(questionOrder);
            } else {
                questionOrder = Array.from(Array(questions.length).keys()); // 恢复顺序
            }

            renderQuestion();
            updateQuestionNumberStyles();
            prevBtn.disabled = false;
            nextBtn.disabled = false;
            questionNumbersContainer.querySelectorAll("button").forEach(button => button.disabled = false);
        });

        // 初始化完成按钮显示状态
        completeBtn.classList.remove("hidden");

        // 监听所有回答的按钮，当最后一个题回答时显示完成按钮
        questionContainer.addEventListener('click', function (e) {
            if (e.target && e.target.matches('button')) {
                let allAnswered = true;
                for (let i = 0; i < questions.length; i++) {
                    const questionIndex = questionOrder[i];
                    if (userAnswers[questionIndex] === null) {
                        allAnswered = false;
                        break;
                    }
                }
                if (allAnswered) {
                    completeBtn.classList.remove("hidden");
                }
            }
        });
    </script>
</body>

</html>
