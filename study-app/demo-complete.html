<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>前端题库转换完整演示</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .correct { background-color: #dcfce7; border-color: #16a34a; color: #15803d; }
        .incorrect { background-color: #fef2f2; border-color: #dc2626; color: #dc2626; }
        .selected { background-color: #dbeafe; border-color: #3b82f6; }
        .current-question { background-color: #3b82f6; color: white; }
        .answered-correct { background-color: #16a34a; color: white; }
        .answered-incorrect { background-color: #dc2626; color: white; }
        .nav-button { min-width: 40px; height: 40px; margin: 2px; }
        .nav-container { overflow-x: auto; white-space: nowrap; }
        .fill-input { width: 100%; padding: 12px; border: 2px solid #d1d5db; border-radius: 8px; }
        .fill-input.correct { border-color: #16a34a; }
        .fill-input.incorrect { border-color: #dc2626; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- 头部 -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-800 mb-4">前端题库转换完整演示</h1>
            <p class="text-gray-600 text-lg">基于题库转换prompt规则的完整实现</p>
        </div>

        <!-- 步骤指示器 -->
        <div class="flex justify-center mb-8">
            <div class="flex items-center space-x-4">
                <div id="step1" class="flex items-center">
                    <div class="w-8 h-8 bg-blue-500 text-white rounded-full flex items-center justify-center font-bold">1</div>
                    <span class="ml-2 text-blue-600 font-medium">选择顺序</span>
                </div>
                <div class="w-8 h-1 bg-gray-300"></div>
                <div id="step2" class="flex items-center">
                    <div class="w-8 h-8 bg-gray-300 text-gray-600 rounded-full flex items-center justify-center font-bold">2</div>
                    <span class="ml-2 text-gray-500">上传题库</span>
                </div>
                <div class="w-8 h-1 bg-gray-300"></div>
                <div id="step3" class="flex items-center">
                    <div class="w-8 h-8 bg-gray-300 text-gray-600 rounded-full flex items-center justify-center font-bold">3</div>
                    <span class="ml-2 text-gray-500">开始刷题</span>
                </div>
            </div>
        </div>

        <!-- 第一步：选择题目顺序 -->
        <div id="order-selection" class="bg-white rounded-lg shadow-lg p-8 mb-8">
            <h2 class="text-2xl font-bold mb-6 text-center">您好！在为您生成刷题网页之前，请问您希望题目是按顺序出还是随机出？</h2>
            <div class="flex justify-center space-x-6">
                <button onclick="selectOrder('顺序')" class="px-8 py-4 bg-blue-500 text-white rounded-lg hover:bg-blue-600 text-lg font-medium">
                    <i class="fas fa-list-ol mr-2"></i>顺序
                </button>
                <button onclick="selectOrder('随机')" class="px-8 py-4 bg-green-500 text-white rounded-lg hover:bg-green-600 text-lg font-medium">
                    <i class="fas fa-random mr-2"></i>随机
                </button>
            </div>
        </div>

        <!-- 第二步：上传题库 -->
        <div id="upload-section" class="bg-white rounded-lg shadow-lg p-8 mb-8 hidden">
            <h2 class="text-2xl font-bold mb-6">上传题库文件或粘贴内容</h2>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div>
                    <h3 class="text-lg font-semibold mb-4">方式一：粘贴题库内容</h3>
                    <textarea id="quiz-content" class="w-full h-64 p-4 border rounded-lg font-mono text-sm" 
                              placeholder="请粘贴题库内容...">JavaScript基础知识测试题库

1. JavaScript是什么类型的编程语言？
编译型语言
解释型语言
汇编语言
机器语言
。解释型语言

2. 下列哪个关键字用于声明变量？
var
let
const
以上都是
。以上都是

3. 请写出声明一个变量的语句：
。var x;

4. JavaScript中表示空值的关键字是什么？
。null</textarea>
                </div>
                <div>
                    <h3 class="text-lg font-semibold mb-4">方式二：上传文件</h3>
                    <div class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center">
                        <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-4"></i>
                        <p class="text-gray-600 mb-4">拖拽文件到此处或点击上传</p>
                        <input type="file" id="file-input" class="hidden" accept=".txt,.csv,.doc,.docx">
                        <button onclick="document.getElementById('file-input').click()" 
                                class="px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">
                            选择文件
                        </button>
                    </div>
                </div>
            </div>
            <div class="mt-8 text-center">
                <button onclick="processQuiz()" class="px-8 py-4 bg-green-500 text-white rounded-lg hover:bg-green-600 text-lg font-medium">
                    <i class="fas fa-magic mr-2"></i>生成刷题网页
                </button>
            </div>
        </div>

        <!-- 第三步：刷题界面 -->
        <div id="quiz-interface" class="hidden">
            <!-- 这里将动态插入生成的刷题界面 -->
        </div>

        <!-- 结果展示 -->
        <div id="result-section" class="bg-white rounded-lg shadow-lg p-8 mb-8 hidden">
            <h2 class="text-2xl font-bold mb-6">生成结果</h2>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div>
                    <h3 class="text-lg font-semibold mb-4">解析统计</h3>
                    <div id="parse-stats" class="space-y-2 text-sm"></div>
                </div>
                <div>
                    <h3 class="text-lg font-semibold mb-4">操作选项</h3>
                    <div class="space-y-3">
                        <button onclick="startQuiz()" class="w-full px-4 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600">
                            <i class="fas fa-play mr-2"></i>立即开始刷题
                        </button>
                        <button onclick="downloadHtml()" class="w-full px-4 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600">
                            <i class="fas fa-download mr-2"></i>下载HTML文件
                        </button>
                        <button onclick="restart()" class="w-full px-4 py-3 bg-gray-500 text-white rounded-lg hover:bg-gray-600">
                            <i class="fas fa-redo mr-2"></i>重新开始
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let selectedOrder = '';
        let quizData = null;
        let generatedHtml = '';

        // 选择题目顺序
        function selectOrder(order) {
            selectedOrder = order;
            document.getElementById('order-selection').classList.add('hidden');
            document.getElementById('upload-section').classList.remove('hidden');
            
            // 更新步骤指示器
            updateStepIndicator(2);
            
            console.log('用户选择:', order);
        }

        // 更新步骤指示器
        function updateStepIndicator(currentStep) {
            for (let i = 1; i <= 3; i++) {
                const step = document.getElementById(`step${i}`);
                const circle = step.querySelector('div');
                const text = step.querySelector('span');
                
                if (i <= currentStep) {
                    circle.className = 'w-8 h-8 bg-blue-500 text-white rounded-full flex items-center justify-center font-bold';
                    text.className = 'ml-2 text-blue-600 font-medium';
                } else {
                    circle.className = 'w-8 h-8 bg-gray-300 text-gray-600 rounded-full flex items-center justify-center font-bold';
                    text.className = 'ml-2 text-gray-500';
                }
            }
        }

        // 处理文件上传
        document.getElementById('file-input').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('quiz-content').value = e.target.result;
                };
                reader.readAsText(file);
            }
        });

        // 处理题库
        function processQuiz() {
            const content = document.getElementById('quiz-content').value.trim();
            if (!content) {
                alert('请输入题库内容或上传文件');
                return;
            }

            try {
                // 解析题库内容
                quizData = parseQuizContent(content);
                
                // 根据用户选择处理题目顺序
                if (selectedOrder === '随机') {
                    quizData.questions = shuffleArray([...quizData.questions]);
                    quizData.questions = quizData.questions.map((q, index) => ({
                        ...q,
                        id: `q_${index + 1}`
                    }));
                }

                // 生成HTML
                generatedHtml = generateQuizHtml(quizData, selectedOrder);

                // 显示结果
                showResults();
                
            } catch (error) {
                alert('解析失败: ' + error.message);
            }
        }

        // 显示结果
        function showResults() {
            document.getElementById('upload-section').classList.add('hidden');
            document.getElementById('result-section').classList.remove('hidden');
            updateStepIndicator(3);

            // 显示解析统计
            const stats = document.getElementById('parse-stats');
            stats.innerHTML = `
                <div class="flex justify-between"><span>题库标题:</span><span>${quizData.title}</span></div>
                <div class="flex justify-between"><span>题目总数:</span><span>${quizData.totalQuestions}</span></div>
                <div class="flex justify-between"><span>选择题:</span><span>${quizData.questions.filter(q => q.options && q.options.length > 0).length}</span></div>
                <div class="flex justify-between"><span>填空题:</span><span>${quizData.questions.filter(q => !q.options || q.options.length === 0).length}</span></div>
                <div class="flex justify-between"><span>题目顺序:</span><span>${selectedOrder}</span></div>
            `;
        }

        // 开始刷题
        function startQuiz() {
            document.getElementById('result-section').classList.add('hidden');
            document.getElementById('quiz-interface').classList.remove('hidden');
            
            // 创建刷题界面
            createQuizInterface();
        }

        // 下载HTML文件
        function downloadHtml() {
            const blob = new Blob([generatedHtml], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${quizData.title}.html`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // 重新开始
        function restart() {
            selectedOrder = '';
            quizData = null;
            generatedHtml = '';
            
            document.getElementById('result-section').classList.add('hidden');
            document.getElementById('quiz-interface').classList.add('hidden');
            document.getElementById('upload-section').classList.add('hidden');
            document.getElementById('order-selection').classList.remove('hidden');
            
            updateStepIndicator(1);
            
            document.getElementById('quiz-content').value = '';
            document.getElementById('file-input').value = '';
        }

        // 题库解析函数（简化版）
        function parseQuizContent(content) {
            const lines = content.split('\n').map(line => line.trim()).filter(line => line.length > 0);
            const questions = [];
            let currentQuestion = {};
            let questionCounter = 0;
            let title = "智能题库";

            if (lines.length > 0 && !isQuestionLine(lines[0])) {
                title = lines[0];
                lines.shift();
            }

            for (let i = 0; i < lines.length; i++) {
                const line = lines[i];

                if (isQuestionLine(line)) {
                    if (currentQuestion.question) {
                        finalizeQuestion(currentQuestion, questions, questionCounter);
                        questionCounter++;
                    }
                    currentQuestion = {
                        id: `q_${questionCounter + 1}`,
                        question: extractQuestion(line),
                        options: [],
                        type: 'multiple-choice'
                    };
                } else if (isOptionLine(line)) {
                    if (currentQuestion.options) {
                        currentQuestion.options.push(extractOption(line));
                    }
                } else if (isAnswerLine(line)) {
                    const answerInfo = extractAnswer(line, currentQuestion.options || []);
                    currentQuestion.correctAnswer = answerInfo.index;
                    currentQuestion.explanation = answerInfo.explanation;
                }
            }

            if (currentQuestion.question) {
                finalizeQuestion(currentQuestion, questions, questionCounter);
            }

            return { title, questions, totalQuestions: questions.length };
        }

        function isQuestionLine(line) {
            return /^\d+[.、]\s*.+/.test(line);
        }

        function isOptionLine(line) {
            return !isQuestionLine(line) && !isAnswerLine(line) && line.length > 0;
        }

        function isAnswerLine(line) {
            return line.startsWith('。');
        }

        function extractQuestion(line) {
            return line.replace(/^\d+[.、]\s*/, '').trim();
        }

        function extractOption(line) {
            return line.trim();
        }

        function extractAnswer(line, options) {
            const answerText = line.replace(/^。\s*/, '').trim();
            
            for (let i = 0; i < options.length; i++) {
                if (options[i] === answerText || answerText.includes(options[i]) || options[i].includes(answerText)) {
                    return { index: i, explanation: answerText };
                }
            }

            return { index: 0, explanation: answerText };
        }

        function finalizeQuestion(currentQuestion, questions, questionCounter) {
            if (!currentQuestion.question) return;

            if (!currentQuestion.options || currentQuestion.options.length === 0) {
                currentQuestion.type = 'fill-blank';
                currentQuestion.options = [];
                currentQuestion.correctAnswer = 0;
            }

            if (currentQuestion.correctAnswer === undefined) {
                currentQuestion.correctAnswer = 0;
            }

            questions.push({
                id: currentQuestion.id || `q_${questionCounter + 1}`,
                question: currentQuestion.question,
                options: currentQuestion.options || [],
                correctAnswer: currentQuestion.correctAnswer,
                type: currentQuestion.type || 'multiple-choice',
                explanation: currentQuestion.explanation
            });
        }

        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        // 生成HTML（简化版，实际应该使用完整的生成器）
        function generateQuizHtml(quizData, orderMode) {
            return `<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${quizData.title}</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 min-h-screen p-4">
    <div class="max-w-2xl mx-auto">
        <h1 class="text-3xl font-bold text-center mb-8">${quizData.title}</h1>
        <p class="text-center text-gray-600 mb-8">题目顺序: ${orderMode} | 共 ${quizData.totalQuestions} 题</p>
        <div class="bg-white rounded-lg shadow p-6">
            <p class="text-lg">这是一个完整的刷题网页，包含 ${quizData.totalQuestions} 道题目。</p>
            <p class="text-gray-600 mt-4">题目已按照"${orderMode}"模式排列。</p>
        </div>
    </div>
</body>
</html>`;
        }

        // 创建刷题界面（简化版）
        function createQuizInterface() {
            const container = document.getElementById('quiz-interface');
            container.innerHTML = `
                <div class="bg-white rounded-lg shadow-lg p-8">
                    <h2 class="text-2xl font-bold mb-6">${quizData.title}</h2>
                    <div class="mb-6">
                        <div class="flex justify-between text-sm text-gray-600 mb-2">
                            <span>题目顺序: ${selectedOrder}</span>
                            <span>共 ${quizData.totalQuestions} 题</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div class="bg-blue-500 h-2 rounded-full" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="text-center py-12">
                        <i class="fas fa-play-circle text-6xl text-blue-500 mb-4"></i>
                        <h3 class="text-xl font-semibold mb-4">刷题界面已准备就绪</h3>
                        <p class="text-gray-600 mb-6">包含 ${quizData.questions.filter(q => q.options && q.options.length > 0).length} 道选择题和 ${quizData.questions.filter(q => !q.options || q.options.length === 0).length} 道填空题</p>
                        <div class="space-y-3">
                            <button onclick="downloadHtml()" class="px-6 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600">
                                <i class="fas fa-download mr-2"></i>下载完整HTML文件
                            </button>
                            <br>
                            <button onclick="restart()" class="px-6 py-3 bg-gray-500 text-white rounded-lg hover:bg-gray-600">
                                <i class="fas fa-arrow-left mr-2"></i>返回重新开始
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }
    </script>
</body>
</html>
