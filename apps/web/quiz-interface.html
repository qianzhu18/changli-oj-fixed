<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºèƒ½åˆ·é¢˜ç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .progress-bar {
            background: rgba(255,255,255,0.2);
            height: 8px;
            border-radius: 4px;
            margin-top: 20px;
            overflow: hidden;
        }

        .progress-fill {
            background: white;
            height: 100%;
            border-radius: 4px;
            transition: width 0.3s ease;
            width: 0%;
        }

        .quiz-content {
            padding: 40px;
        }

        .question-card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            border-left: 5px solid #4facfe;
        }

        .question-number {
            color: #4facfe;
            font-weight: 600;
            font-size: 1.1em;
            margin-bottom: 15px;
        }

        .question-text {
            font-size: 1.3em;
            line-height: 1.6;
            color: #2c3e50;
            margin-bottom: 25px;
        }

        .options {
            display: grid;
            gap: 15px;
        }

        .option {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            font-size: 1.1em;
        }

        .option:hover {
            border-color: #4facfe;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(79, 172, 254, 0.2);
        }

        .option.selected {
            border-color: #4facfe;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .option.correct {
            border-color: #28a745;
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
        }

        .option.incorrect {
            border-color: #dc3545;
            background: linear-gradient(135deg, #dc3545 0%, #fd7e14 100%);
            color: white;
        }

        .option-label {
            background: #4facfe;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-weight: 600;
        }

        .option.selected .option-label,
        .option.correct .option-label,
        .option.incorrect .option-label {
            background: rgba(255,255,255,0.2);
        }

        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 30px;
            padding-top: 30px;
            border-top: 1px solid #e9ecef;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(79, 172, 254, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        .explanation {
            background: #e8f5e8;
            border: 1px solid #28a745;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            display: none;
        }

        .explanation.show {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .explanation h4 {
            color: #28a745;
            margin-bottom: 10px;
        }

        .stats {
            display: flex;
            justify-content: space-around;
            text-align: center;
            margin-bottom: 20px;
        }

        .stat-item {
            color: rgba(255,255,255,0.9);
        }

        .stat-number {
            font-size: 2em;
            font-weight: 700;
            display: block;
        }

        .stat-label {
            font-size: 0.9em;
            opacity: 0.8;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .hidden {
            display: none;
        }

        .quiz-complete {
            text-align: center;
            padding: 40px;
        }

        .quiz-complete h2 {
            color: #4facfe;
            font-size: 2.5em;
            margin-bottom: 20px;
        }

        .final-score {
            font-size: 3em;
            font-weight: 700;
            color: #28a745;
            margin: 20px 0;
        }

        .upload-area {
            border: 2px dashed #4facfe;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            margin-bottom: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .upload-area:hover {
            border-color: #00f2fe;
            background: rgba(79, 172, 254, 0.05);
        }

        .upload-area.dragover {
            border-color: #00f2fe;
            background: rgba(79, 172, 254, 0.1);
        }

        #fileInput {
            display: none;
        }

        .upload-icon {
            font-size: 3em;
            color: #4facfe;
            margin-bottom: 15px;
        }

        .upload-text {
            font-size: 1.2em;
            color: #6c757d;
            margin-bottom: 10px;
        }

        .upload-hint {
            color: #adb5bd;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 id="quizTitle">æ™ºèƒ½åˆ·é¢˜ç³»ç»Ÿ</h1>
            <div class="stats">
                <div class="stat-item">
                    <span class="stat-number" id="currentQuestion">0</span>
                    <span class="stat-label">å½“å‰é¢˜ç›®</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number" id="totalQuestions">0</span>
                    <span class="stat-label">æ€»é¢˜æ•°</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number" id="correctCount">0</span>
                    <span class="stat-label">æ­£ç¡®æ•°</span>
                </div>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
        </div>

        <div class="quiz-content">
            <!-- æ–‡ä»¶ä¸Šä¼ åŒºåŸŸ -->
            <div id="uploadSection">
                <div class="upload-area" onclick="document.getElementById('fileInput').click()">
                    <div class="upload-icon">ğŸ“</div>
                    <div class="upload-text">ç‚¹å‡»ä¸Šä¼ é¢˜åº“æ–‡ä»¶</div>
                    <div class="upload-hint">å½“å‰ä»…æ”¯æŒçº¯æ–‡æœ¬é¢˜åº“ (.txt/.md)</div>
                </div>
                <input type="file" id="fileInput" accept=".txt,.md" />
            </div>

            <!-- é¢˜ç›®æ˜¾ç¤ºåŒºåŸŸ -->
            <div id="questionSection" class="hidden">
                <div class="question-card">
                    <div class="question-number" id="questionNumber">é¢˜ç›® 1</div>
                    <div class="question-text" id="questionText"></div>
                    <div class="options" id="optionsContainer"></div>
                    <div class="explanation" id="explanation">
                        <h4>è§£æï¼š</h4>
                        <p id="explanationText"></p>
                    </div>
                </div>

                <div class="controls">
                    <button class="btn btn-secondary" id="prevBtn" onclick="previousQuestion()">ä¸Šä¸€é¢˜</button>
                    <button class="btn btn-primary" id="nextBtn" onclick="nextQuestion()">ä¸‹ä¸€é¢˜</button>
                    <button class="btn btn-primary hidden" id="submitBtn" onclick="submitAnswer()">æäº¤ç­”æ¡ˆ</button>
                </div>
            </div>

            <!-- å®Œæˆé¡µé¢ -->
            <div id="completeSection" class="hidden quiz-complete">
                <h2>ğŸ‰ æ­å–œå®Œæˆï¼</h2>
                <div class="final-score" id="finalScore">0/0</div>
                <p>æ­£ç¡®ç‡ï¼š<span id="accuracy">0%</span></p>
                <button class="btn btn-primary" onclick="restartQuiz()">é‡æ–°å¼€å§‹</button>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let quizData = null;
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let correctCount = 0;
        let isAnswered = false;

        // æ–‡ä»¶ä¸Šä¼ å¤„ç†
        document.getElementById('fileInput').addEventListener('change', handleFileUpload);

        // æ‹–æ‹½ä¸Šä¼ 
        const uploadArea = document.querySelector('.upload-area');
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFileUpload({ target: { files } });
            }
        });

        async function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            try {
                // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                uploadArea.innerHTML = '<div class="upload-icon">â³</div><div class="upload-text">æ­£åœ¨è§£ææ–‡ä»¶...</div>';

                // è¯»å–æ–‡ä»¶å†…å®¹
                const content = await readFileContent(file);
                
                // è§£æé¢˜åº“å†…å®¹
                quizData = parseQuizContent(content);
                
                if (quizData.questions.length === 0) {
                    throw new Error('æœªèƒ½ä»æ–‡ä»¶ä¸­è§£æå‡ºæœ‰æ•ˆé¢˜ç›®');
                }

                // åˆå§‹åŒ–åˆ·é¢˜ç•Œé¢
                initializeQuiz();
                
            } catch (error) {
                console.error('æ–‡ä»¶å¤„ç†é”™è¯¯:', error);
                uploadArea.innerHTML = `
                    <div class="upload-icon">âŒ</div>
                    <div class="upload-text">æ–‡ä»¶è§£æå¤±è´¥</div>
                    <div class="upload-hint">${error.message}</div>
                `;
                setTimeout(() => {
                    uploadArea.innerHTML = `
                        <div class="upload-icon">ğŸ“</div>
                        <div class="upload-text">ç‚¹å‡»ä¸Šä¼ é¢˜åº“æ–‡ä»¶</div>
                        <div class="upload-hint">æ”¯æŒ Word (.docx/.doc)ã€Excel (.xlsx/.xls)ã€æ–‡æœ¬ (.txt/.md)ã€PDF (.pdf) æ ¼å¼</div>
                    `;
                }, 3000);
            }
        }

        async function readFileContent(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (e) => resolve(e.target.result);
                reader.onerror = () => reject(new Error('æ–‡ä»¶è¯»å–å¤±è´¥'));
                reader.readAsText(file, 'UTF-8');
            });
        }

        // æ™ºèƒ½é¢˜åº“è§£æå™¨
        function parseQuizContent(content) {
            console.log('å¼€å§‹è§£æå†…å®¹:', content.substring(0, 200) + '...');

            // æ£€æµ‹å†…å®¹æ ¼å¼
            const detectedFormat = detectContentFormat(content);
            console.log('æ£€æµ‹åˆ°çš„æ ¼å¼:', detectedFormat);

            switch (detectedFormat) {
                case 'standard':
                    return parseStandardFormat(content);
                case 'numbered-only':
                    return parseNumberedOnlyFormat(content);
                case 'mixed':
                    return parseMixedFormat(content);
                default:
                    return createFallbackQuiz(content);
            }
        }

        function detectContentFormat(content) {
            const lines = content.split('\n').map(line => line.trim()).filter(line => line.length > 0);

            let hasQuestions = false;
            let hasOptions = false;
            let hasAnswers = false;

            for (const line of lines) {
                if (isQuestionLine(line)) {
                    hasQuestions = true;
                }
                if (isOptionLine(line) && /^[A-D][.ã€]\s*.+/.test(line)) {
                    hasOptions = true;
                }
                if (isAnswerLine(line)) {
                    hasAnswers = true;
                }
            }

            if (hasQuestions && hasOptions && hasAnswers) {
                return 'standard';
            } else if (hasQuestions && !hasOptions) {
                return 'numbered-only';
            } else if (hasQuestions || hasOptions) {
                return 'mixed';
            }

            return 'unknown';
        }

        function parseStandardFormat(content) {
            const lines = content.split('\n').map(line => line.trim()).filter(line => line.length > 0);
            const questions = [];
            let currentQuestion = null;
            let title = "æ™ºèƒ½é¢˜åº“";

            // æå–æ ‡é¢˜
            if (lines.length > 0 && !isQuestionLine(lines[0])) {
                title = lines[0];
                lines.shift();
            }

            for (let i = 0; i < lines.length; i++) {
                const line = lines[i];

                if (isQuestionLine(line)) {
                    // ä¿å­˜ä¸Šä¸€é¢˜
                    if (currentQuestion) {
                        finalizeQuestion(currentQuestion, questions);
                    }

                    // å¼€å§‹æ–°é¢˜
                    currentQuestion = {
                        id: `q_${questions.length + 1}`,
                        question: extractQuestion(line),
                        options: [],
                        correctAnswer: 0,
                        type: 'multiple-choice'
                    };
                }
                else if (isOptionLine(line) && currentQuestion) {
                    currentQuestion.options.push(extractOption(line));
                }
                else if (isAnswerLine(line) && currentQuestion) {
                    const answerInfo = extractAnswer(line, currentQuestion.options);
                    currentQuestion.correctAnswer = answerInfo.index;
                    currentQuestion.explanation = answerInfo.explanation;
                }
                else if (currentQuestion && currentQuestion.question && !isOptionLine(line) && !isAnswerLine(line)) {
                    currentQuestion.question += ' ' + line;
                }
            }

            // ä¿å­˜æœ€åä¸€é¢˜
            if (currentQuestion) {
                finalizeQuestion(currentQuestion, questions);
            }

            return {
                title,
                questions,
                totalQuestions: questions.length
            };
        }

        function parseNumberedOnlyFormat(content) {
            const lines = content.split('\n').map(line => line.trim()).filter(line => line.length > 0);
            const questions = [];
            let title = "æ™ºèƒ½é¢˜åº“";
            let currentQuestion = null;

            // æå–æ ‡é¢˜
            if (lines.length > 0 && !isQuestionLine(lines[0]) && !isNumberedOptionLine(lines[0])) {
                title = lines[0];
                lines.shift();
            }

            for (let i = 0; i < lines.length; i++) {
                const line = lines[i];

                if (isQuestionLine(line)) {
                    // ä¿å­˜ä¸Šä¸€é¢˜
                    if (currentQuestion) {
                        finalizeNumberedQuestion(currentQuestion, questions, content);
                    }

                    // å¼€å§‹æ–°é¢˜
                    currentQuestion = {
                        id: `q_${questions.length + 1}`,
                        question: extractQuestion(line),
                        options: [],
                        correctAnswer: 0,
                        type: 'multiple-choice'
                    };
                }
                else if (isNumberedOptionLine(line) && currentQuestion) {
                    currentQuestion.options.push(extractNumberedOption(line));
                }
                else if (currentQuestion && currentQuestion.question && !isNumberedOptionLine(line) && line.length > 10) {
                    currentQuestion.question += ' ' + line;
                }
            }

            // ä¿å­˜æœ€åä¸€é¢˜
            if (currentQuestion) {
                finalizeNumberedQuestion(currentQuestion, questions, content);
            }

            return {
                title,
                questions,
                totalQuestions: questions.length
            };
        }

        function parseMixedFormat(content) {
            // å…ˆå°è¯•æ ‡å‡†æ ¼å¼è§£æ
            const standardResult = parseStandardFormat(content);

            // å¦‚æœè§£æå‡ºçš„é¢˜ç›®å¤ªå°‘ï¼Œå°è¯•ç¼–å·æ ¼å¼
            if (standardResult.questions.length === 0) {
                return parseNumberedOnlyFormat(content);
            }

            return standardResult;
        }

        function createFallbackQuiz(content) {
            const contentLength = content.length;
            const wordCount = content.split(/\s+/).length;

            const fallbackQuestion = {
                id: "q_1",
                question: `åŸºäºæ‚¨æä¾›çš„å†…å®¹ï¼ˆ${contentLength} ä¸ªå­—ç¬¦ï¼Œçº¦ ${wordCount} ä¸ªè¯ï¼‰ï¼Œè¯·é€‰æ‹©æœ€åˆé€‚çš„æè¿°ï¼š`,
                options: [
                    "å†…å®¹å·²æˆåŠŸè§£æï¼Œå¯ä»¥ç”Ÿæˆé¢˜åº“",
                    "å†…å®¹æ ¼å¼éœ€è¦è°ƒæ•´",
                    "éœ€è¦æ›´å¤šä¿¡æ¯æ‰èƒ½å¤„ç†",
                    "å†…å®¹åŒ…å«æœ‰æ•ˆçš„å­¦ä¹ ææ–™"
                ],
                correctAnswer: 0,
                type: 'multiple-choice',
                explanation: "å†…å®¹å·²æˆåŠŸè§£æï¼Œå¯ä»¥ç”Ÿæˆé¢˜åº“"
            };

            return {
                title: "æ™ºèƒ½è§£æé¢˜åº“",
                questions: [fallbackQuestion],
                totalQuestions: 1
            };
        }

        function finalizeQuestion(currentQuestion, questions) {
            if (!currentQuestion.question) return;

            if (currentQuestion.options.length === 0) {
                // ç”Ÿæˆé»˜è®¤é€‰é¡¹
                currentQuestion.options = [
                    "é€‰é¡¹ A",
                    "é€‰é¡¹ B",
                    "é€‰é¡¹ C",
                    "é€‰é¡¹ D"
                ];
            }

            questions.push(currentQuestion);
        }

        function finalizeNumberedQuestion(currentQuestion, questions, fullContent) {
            if (!currentQuestion.question) return;

            // å¦‚æœæœ‰é€‰é¡¹ï¼Œä½¿ç”¨é€‰é¡¹ï¼›å¦åˆ™ç”Ÿæˆæ™ºèƒ½é€‰é¡¹
            if (currentQuestion.options.length > 0) {
                // æœ‰é€‰é¡¹çš„æƒ…å†µï¼Œé»˜è®¤ç¬¬ä¸€ä¸ªä¸ºæ­£ç¡®ç­”æ¡ˆ
                currentQuestion.correctAnswer = 0;
                currentQuestion.explanation = currentQuestion.options[0];
            } else {
                // æ²¡æœ‰é€‰é¡¹ï¼Œç”Ÿæˆæ™ºèƒ½é€‰é¡¹
                const generatedOptions = generateSmartOptions(currentQuestion.question, fullContent);
                currentQuestion.options = generatedOptions.options;
                currentQuestion.correctAnswer = generatedOptions.correctIndex;
                currentQuestion.explanation = generatedOptions.explanation;
            }

            questions.push(currentQuestion);
        }

        function generateSmartOptions(questionText, fullContent) {
            const question = questionText.toLowerCase();

            if (question.includes('ä»€ä¹ˆ') || question.includes('å“ªä¸ª') || question.includes('é€‰æ‹©')) {
                return {
                    options: [
                        "æ­£ç¡®ç­”æ¡ˆï¼ˆåŸºäºæ–‡æ¡£å†…å®¹ï¼‰",
                        "ç›¸å…³ä½†ä¸æ­£ç¡®çš„é€‰é¡¹",
                        "æ˜æ˜¾é”™è¯¯çš„é€‰é¡¹",
                        "å¹²æ‰°æ€§é€‰é¡¹"
                    ],
                    correctIndex: 0,
                    explanation: "æ­£ç¡®ç­”æ¡ˆï¼ˆåŸºäºæ–‡æ¡£å†…å®¹ï¼‰"
                };
            }

            if (question.includes('å¦‚ä½•') || question.includes('æ€æ ·') || question.includes('æ–¹æ³•')) {
                return {
                    options: [
                        "æŒ‰ç…§æ–‡æ¡£æè¿°çš„æ­£ç¡®æ–¹æ³•",
                        "å¸¸è§çš„é”™è¯¯åšæ³•",
                        "ä¸ç›¸å…³çš„æ–¹æ³•",
                        "è¿‡æ—¶çš„æ–¹æ³•"
                    ],
                    correctIndex: 0,
                    explanation: "æŒ‰ç…§æ–‡æ¡£æè¿°çš„æ­£ç¡®æ–¹æ³•"
                };
            }

            if (question.includes('æ˜¯å¦') || question.includes('å¯¹é”™') || question.includes('æ­£ç¡®')) {
                return {
                    options: [
                        "æ˜¯",
                        "å¦",
                        "éƒ¨åˆ†æ­£ç¡®",
                        "æ— æ³•ç¡®å®š"
                    ],
                    correctIndex: 0,
                    explanation: "æ˜¯"
                };
            }

            // é»˜è®¤é€‰é¡¹
            return {
                options: [
                    "æ ¹æ®å†…å®¹åˆ†æçš„æ­£ç¡®ç­”æ¡ˆ",
                    "å¯èƒ½çš„æ›¿ä»£ç­”æ¡ˆ",
                    "ä¸å¤ªå¯èƒ½çš„é€‰é¡¹",
                    "æ˜æ˜¾é”™è¯¯çš„é€‰é¡¹"
                ],
                correctIndex: 0,
                explanation: "æ ¹æ®å†…å®¹åˆ†æçš„æ­£ç¡®ç­”æ¡ˆ"
            };
        }

        function isQuestionLine(line) {
            // æ£€æŸ¥æ˜¯å¦ä»¥"é¢˜ç›®"å¼€å¤´
            if (line.startsWith('é¢˜ç›®')) {
                return true;
            }

            if (/^\d+[.ã€]\s*.+/.test(line)) {
                // é¢˜ç›®é€šå¸¸åŒ…å«ç–‘é—®è¯ã€é—®å·ï¼Œæˆ–è€…é•¿åº¦è¾ƒé•¿
                return line.includes('ï¼Ÿ') || line.includes('?') ||
                       line.includes('ä»€ä¹ˆ') || line.includes('å“ªä¸ª') || line.includes('å¦‚ä½•') ||
                       line.includes('æ˜¯å¦') || line.includes('é€‰æ‹©') || line.includes('æè¿°') ||
                       line.length > 20;
            }
            return false;
        }

        function isOptionLine(line) {
            // æ£€æŸ¥æ˜¯å¦ä»¥Aã€Bã€Cã€Då¼€å¤´çš„é€‰é¡¹æ ¼å¼
            if (/^[A-D][.ã€]\s*.+/.test(line)) {
                return true;
            }

            // æ£€æŸ¥æ˜¯å¦ä»¥æ•°å­—å¼€å¤´çš„é€‰é¡¹æ ¼å¼ï¼ˆå¦‚ï¼š1 é€‰é¡¹å†…å®¹ï¼‰
            if (/^\d+\s+.+/.test(line) && !isQuestionLine(line)) {
                return true;
            }

            // æ£€æŸ¥æ˜¯å¦ä»¥æ•°å­—å’Œç‚¹å¼€å¤´ä½†ä¸æ˜¯é¢˜ç›®çš„é€‰é¡¹æ ¼å¼
            if (/^\d+[.]\s*.+/.test(line) && !isQuestionLine(line) && line.length < 100) {
                return true;
            }

            return !isQuestionLine(line) && !isAnswerLine(line) && line.length > 0 && line.length < 200;
        }

        function isNumberedOptionLine(line) {
            // åŒ¹é… "1 é€‰é¡¹å†…å®¹" æˆ– "1. é€‰é¡¹å†…å®¹" æ ¼å¼ï¼Œä½†ä¸æ˜¯é¢˜ç›®
            return /^\d+\s+.+/.test(line) || (/^\d+[.]\s*.+/.test(line) && !isQuestionLine(line));
        }

        function isAnswerLine(line) {
            return /^ç­”æ¡ˆ[ï¼š:]\s*[A-D]/.test(line) || /^æ­£ç¡®ç­”æ¡ˆ[ï¼š:]\s*[A-D]/.test(line);
        }

        function extractQuestion(line) {
            return line.replace(/^(é¢˜ç›®\s*\d*[.ã€]?|\d+[.ã€])\s*/, '').trim();
        }

        function extractOption(line) {
            return line.trim();
        }

        function extractNumberedOption(line) {
            return line.replace(/^\d+[.\s]*/, '').trim();
        }

        function extractAnswer(line, options) {
            const match = line.match(/[A-D]/);
            if (match) {
                const answerLetter = match[0];
                const index = answerLetter.charCodeAt(0) - 65; // A=0, B=1, C=2, D=3
                const explanation = options[index] || answerLetter;
                return { index, explanation };
            }
            return { index: 0, explanation: "æ­£ç¡®ç­”æ¡ˆ" };
        }

        function initializeQuiz() {
            // éšè—ä¸Šä¼ åŒºåŸŸï¼Œæ˜¾ç¤ºé¢˜ç›®åŒºåŸŸ
            document.getElementById('uploadSection').classList.add('hidden');
            document.getElementById('questionSection').classList.remove('hidden');

            // åˆå§‹åŒ–çŠ¶æ€
            currentQuestionIndex = 0;
            userAnswers = new Array(quizData.questions.length).fill(null);
            correctCount = 0;
            isAnswered = false;

            // æ›´æ–°æ ‡é¢˜å’Œç»Ÿè®¡
            document.getElementById('quizTitle').textContent = quizData.title;
            document.getElementById('totalQuestions').textContent = quizData.totalQuestions;
            document.getElementById('correctCount').textContent = correctCount;

            // æ˜¾ç¤ºç¬¬ä¸€é¢˜
            showQuestion();
        }

        function showQuestion() {
            const question = quizData.questions[currentQuestionIndex];
            isAnswered = userAnswers[currentQuestionIndex] !== null;

            // æ›´æ–°é¢˜ç›®ä¿¡æ¯
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            document.getElementById('questionNumber').textContent = `é¢˜ç›® ${currentQuestionIndex + 1}`;
            document.getElementById('questionText').textContent = question.question;

            // æ›´æ–°è¿›åº¦æ¡
            const progress = ((currentQuestionIndex + 1) / quizData.totalQuestions) * 100;
            document.getElementById('progressFill').style.width = progress + '%';

            // ç”Ÿæˆé€‰é¡¹
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';

            question.options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'option';
                optionElement.onclick = () => selectOption(index);

                const label = String.fromCharCode(65 + index); // A, B, C, D
                optionElement.innerHTML = `
                    <div class="option-label">${label}</div>
                    <div>${option}</div>
                `;

                // å¦‚æœå·²ç»å›ç­”è¿‡ï¼Œæ˜¾ç¤ºçŠ¶æ€
                if (isAnswered) {
                    if (index === userAnswers[currentQuestionIndex]) {
                        optionElement.classList.add(index === question.correctAnswer ? 'correct' : 'incorrect');
                    }
                    if (index === question.correctAnswer) {
                        optionElement.classList.add('correct');
                    }
                    optionElement.style.pointerEvents = 'none';
                }

                optionsContainer.appendChild(optionElement);
            });

            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            updateButtons();

            // éšè—è§£æ
            document.getElementById('explanation').classList.remove('show');
        }

        function selectOption(optionIndex) {
            if (isAnswered) return;

            // æ¸…é™¤ä¹‹å‰çš„é€‰æ‹©
            document.querySelectorAll('.option').forEach(opt => {
                opt.classList.remove('selected');
            });

            // é€‰ä¸­å½“å‰é€‰é¡¹
            document.querySelectorAll('.option')[optionIndex].classList.add('selected');

            // æ˜¾ç¤ºæäº¤æŒ‰é’®
            document.getElementById('submitBtn').classList.remove('hidden');
            document.getElementById('nextBtn').classList.add('hidden');
        }

        function submitAnswer() {
            const selectedOption = document.querySelector('.option.selected');
            if (!selectedOption) return;

            const selectedIndex = Array.from(document.querySelectorAll('.option')).indexOf(selectedOption);
            const question = quizData.questions[currentQuestionIndex];

            // è®°å½•ç­”æ¡ˆ
            userAnswers[currentQuestionIndex] = selectedIndex;
            isAnswered = true;

            // æ˜¾ç¤ºæ­£ç¡®ç­”æ¡ˆ
            document.querySelectorAll('.option').forEach((opt, index) => {
                opt.style.pointerEvents = 'none';
                if (index === selectedIndex) {
                    opt.classList.add(index === question.correctAnswer ? 'correct' : 'incorrect');
                }
                if (index === question.correctAnswer) {
                    opt.classList.add('correct');
                }
            });

            // æ›´æ–°æ­£ç¡®æ•°
            if (selectedIndex === question.correctAnswer) {
                correctCount++;
                document.getElementById('correctCount').textContent = correctCount;
            }

            // æ˜¾ç¤ºè§£æ
            if (question.explanation) {
                document.getElementById('explanationText').textContent = question.explanation;
                document.getElementById('explanation').classList.add('show');
            }

            // æ›´æ–°æŒ‰é’®
            updateButtons();
        }

        function updateButtons() {
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const submitBtn = document.getElementById('submitBtn');

            prevBtn.style.display = currentQuestionIndex > 0 ? 'inline-block' : 'none';

            if (isAnswered) {
                submitBtn.classList.add('hidden');
                if (currentQuestionIndex < quizData.totalQuestions - 1) {
                    nextBtn.classList.remove('hidden');
                    nextBtn.textContent = 'ä¸‹ä¸€é¢˜';
                } else {
                    nextBtn.classList.remove('hidden');
                    nextBtn.textContent = 'æŸ¥çœ‹ç»“æœ';
                }
            } else {
                submitBtn.classList.add('hidden');
                nextBtn.classList.add('hidden');
            }
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                showQuestion();
            }
        }

        function nextQuestion() {
            if (currentQuestionIndex < quizData.totalQuestions - 1) {
                currentQuestionIndex++;
                showQuestion();
            } else {
                showResults();
            }
        }

        function showResults() {
            document.getElementById('questionSection').classList.add('hidden');
            document.getElementById('completeSection').classList.remove('hidden');

            const accuracy = Math.round((correctCount / quizData.totalQuestions) * 100);
            document.getElementById('finalScore').textContent = `${correctCount}/${quizData.totalQuestions}`;
            document.getElementById('accuracy').textContent = `${accuracy}%`;
        }

        function restartQuiz() {
            document.getElementById('completeSection').classList.add('hidden');
            document.getElementById('uploadSection').classList.remove('hidden');
            
            // é‡ç½®çŠ¶æ€
            quizData = null;
            currentQuestionIndex = 0;
            userAnswers = [];
            correctCount = 0;
            isAnswered = false;
            
            // é‡ç½®ä¸Šä¼ åŒºåŸŸ
            uploadArea.innerHTML = `
                <div class="upload-icon">ğŸ“</div>
                <div class="upload-text">ç‚¹å‡»ä¸Šä¼ é¢˜åº“æ–‡ä»¶</div>
                <div class="upload-hint">å½“å‰ä»…æ”¯æŒçº¯æ–‡æœ¬é¢˜åº“ (.txt/.md)</div>
            `;
        }
    </script>
</body>
</html>
