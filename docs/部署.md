下面是一份「一站式部署上线教程」，帮您把当前的 **Quiz App**（`quiz-app-clean/` 目录）部署到 Vercel 并连通 Neon PostgreSQL 数据库。整套流程全部在浏览器内完成，无需本地运维服务器。

---

## 0. 前置条件

1. GitHub 账号（用于托管代码）
2. Vercel 账号（用于 Serverless 部署）
3. Neon 账号（托管 PostgreSQL）
4. 本地已安装 `git`（用于推送代码）

---

## 1. 准备代码仓库

```bash
# ① 进入项目根目录
cd /Users/.../刷题网站开发

# ② 初始化仓库（若已有可跳过）
git init

# ③ 将所有内容推送到 GitHub
git remote add origin https://github.com/<你的用户名>/quiz-app.git
git add .
git commit -m "feat: initial deploy version"
git push -u origin main
```

> ✅ 推送成功后，在 GitHub “Settings → Actions” 页面可看到默认的 CI 流水线（来自项目中的 `.github/workflows/ci.yml`）。

---

## 2. 创建 Neon 数据库

1. 登录 [neon.tech](https://neon.tech) → **New Project**  
2. 选择 **US (或最近区)** → **Create Project**  
3. 进入 **Connection Details**，复制形如：

```
postgresql://<user>:<password>@ep-xxx.neon.tech/neondb?sslmode=require
```

4. 暂存此字符串，稍后将在 Vercel 设置环境变量。

---

## 3. 在 Vercel 导入项目

1. 登录 [vercel.com](https://vercel.com) → **Add New → Project**  
2. 选择刚才的 `quiz-app` 仓库  
3. 配置参数  

| 选项 | 值 |
|------|----|
| **Framework Preset** | Next.js |
| **Root Directory** | `quiz-app-clean` |
| **Build Command** | `npm run build` (保持默认) |
| **Install Command** | `npm install --legacy-peer-deps` |
| **Output Directory** | `.vercel/output` (默认) |

4. **Environment Variables**（至少填以下两项）  

| Name | Value |
|------|-------|
| `DATABASE_URL` | 复制的 Neon 连接串 |
| `GOOGLE_GEMINI_KEY` | 你的 Gemini API Key |

> 其他可选变量：`NEXTAUTH_SECRET`、`NODE_ENV` 等，按需填写即可。

5. **Deploy**。Vercel 将自动：  
   - 拉取代码  
   - 安装依赖  
   - 运行 `npm run build`（Next.js + Prisma）  
   - 生成 Serverless 函数并上线  
   - URL 形如 `https://quiz-app-clean-xxx.vercel.app`

---

## 4. 数据库迁移（Prisma）

默认情况下，`npm run build` 会在 `postbuild` 脚本内执行 `prisma generate`；  
但线上首次部署仍需 **手动执行迁移**：

1. 进入 Vercel Dashboard → **quiz-app-clean → Functions**  
2. 打开 **Shell**（或使用 `vercel cli` 远程运行）  
3. 运行：

```bash
npx prisma migrate deploy --schema=prisma/schema.prisma
```

若控制台提示 **👍 Migrations complete**，说明数据库 Schema 已就绪。

> ✔ 项目自带的 seed 脚本可选执行：  
> `npx prisma db seed`（若有编写）。

---

## 5. 验证部署

| URL | 预期结果 |
|-----|----------|
| `/` | 显示首页（空题库或示例页面） |
| `/api/health` | `{"status":"ok","db":true}` |
| `/api/ai/validate-key?apiKey=YOUR_KEY` | `{"valid":true}` |

如有错误，可在 **Deployments → Logs** 查看实时日志。

---

## 6. 绑定自定义域名（可选）

1. Vercel 项目 → **Settings → Domains → Add**  
2. 输入域名 `quiz.yourdomain.com`  
3. 按提示在 DNS 服务商添加 `CNAME <hash>.vercel-dns.com`  
4. 等待生效即可自动启用 HTTPS 证书。

---

## 7. 持续部署与回滚

- **推送到 `main`** → 自动触发构建 & 部署  
- **预览环境**：为每个 PR 创建独立 URL  
- **回滚**：在 **Deployments** 选中旧版本 → **Promote** 一键回滚

---

## 8. 常见问题 & 排错

| 现象 | 可能原因 | 解决方案 |
|------|----------|----------|
| 构建失败找不到 `prisma` | 未安装依赖 | 确认 install command 为 `npm install --legacy-peer-deps` |
| `DATABASE_URL` 报错 | 字符串不完整或 SSL 设置问题 | Neon 默认要求 `sslmode=require`，请勿删除 |
| AI 接口 401 | `GOOGLE_GEMINI_KEY` 无效 | 确认已在 Google AI Studio 创建并启用键 |
| 页面 404 | Root Directory 填错 | 确认选择 `quiz-app-clean` 子目录 |

---

## 9. 进一步强化

1. **覆盖率提升**：本地运行 `npm run test`，逐步补充测试 ➡ 推送后自动统计
2. **监控告警**：集成 Vercel Analytics / Sentry
3. **定时备份**：Neon Dashboard 内启用自动备份
4. **CI 审查**：GitHub Actions 已配置 ESLint + 单测，可根据团队标准调整

---

### 🎉 恭喜！  

按以上步骤完成后，您的 Quiz App 将以 Serverless 形式正式上线，全球 CDN 加速、生效即刻。如果遇到任何部署日志或数据库问题，直接把错误信息发我即可。祝上线顺利！