å¥½çš„ï¼Œéµç…§æ‚¨çš„æŒ‡ç¤ºï¼Œæˆ‘ä»¬é€‰æ‹©**æ–¹æ¡ˆä¸€ï¼šæœ¬åœ°æ²‰æµ¸å¼å¼€å‘ + è‡ªåŠ¨åŒ–äº‘å¹³å°éƒ¨ç½²**ã€‚

è¿™æ˜¯ä¸€ä»½ä¸ºæ‚¨é‡èº«å®šåˆ¶çš„å…¨æµç¨‹å¼€å‘æ–‡æ¡£ï¼Œæ—¨åœ¨æŒ‡å¯¼æ‚¨ä»é›¶å¼€å§‹ï¼Œä¸€æ­¥æ­¥æ­å»ºã€å¼€å‘å¹¶ä¸Šçº¿æ‚¨çš„æ™ºèƒ½é¢˜åº“ç½‘ç«™ã€‚

-----

## **æ™ºèƒ½é¢˜åº“è§£æç½‘ç«™ - å…¨æµç¨‹å¼€å‘æ–‡æ¡£**

### 0\. æ–‡æ¡£æ¦‚è¿°

æœ¬é¡¹ç›®æ—¨åœ¨å¼€å‘ä¸€ä¸ªåœ¨çº¿æ™ºèƒ½é¢˜åº“ç½‘ç«™ã€‚ç”¨æˆ·å¯ä»¥æ³¨å†Œç™»å½•ï¼Œé…ç½®è‡ªå·±çš„ Gemini API Keyï¼Œå¹¶åˆ©ç”¨æœ¬ç«™æä¾›çš„æ™ºèƒ½è§£æåŠŸèƒ½ï¼Œå°†æ–‡æœ¬æ ¼å¼çš„é¢˜åº“ä¸€é”®è½¬æ¢ä¸ºå¯åœ¨çº¿åˆ·é¢˜çš„ç½‘é¡µã€‚

æœ¬æ–‡æ¡£å°†è¯¦ç»†é˜è¿°ä½¿ç”¨ä»¥ä¸‹æŠ€æœ¯æ ˆå®Œæˆé¡¹ç›®çš„å…¨è¿‡ç¨‹ï¼š

  * **å‰ç«¯**: Next.js 15 (App Router) + TypeScript + TailwindCSS
  * **åç«¯**: Strapi CMS (Node.js)
  * **æ•°æ®åº“**: PostgreSQL (Neon)
  * **éƒ¨ç½²**: Vercel (å‰ç«¯) + Render (åç«¯)
  * **å¼€å‘ç¯å¢ƒ**: Cursor + Docker
  * **ä»£ç ä»“åº“**: GitHub

**ç³»ç»Ÿæ¶æ„å›¾:**

```mermaid
graph TD
    subgraph "æœ¬åœ°å¼€å‘ç¯å¢ƒ (Local Machine)"
        Dev[Cursor IDE]
        LocalDocker[Docker-Compose: Strapi + PostgreSQL]
        LocalNext[Next.js Dev Server]
        Dev -- ç®¡ç†ä»£ç  --> LocalDocker & LocalNext
    end

    subgraph "çº¿ä¸Šç”Ÿäº§ç¯å¢ƒ (Cloud)"
        Vercel[Next.js Frontend @ Vercel]
        Render[Strapi Backend @ Render]
        Neon[PostgreSQL DB @ Neon]
        Cloudinary[(å¯é€‰) CDN @ Cloudinary]
        Gemini[Google Gemini API]
    end

    subgraph "ä»£ç ä¸éƒ¨ç½²æµç¨‹"
        GitHub[GitHub Repo]
    end

    Dev -- git push --> GitHub
    GitHub -- è‡ªåŠ¨éƒ¨ç½² --> Vercel
    GitHub -- è‡ªåŠ¨éƒ¨ç½² --> Render

    Vercel -- APIè¯·æ±‚ --> Render
    Render -- æ•°æ®åº“è¯»å†™ --> Neon
    Render -- è°ƒç”¨ --> Gemini
    Render -- æ–‡ä»¶å­˜å– --> Cloudinary

    style Dev fill:#1F1F1F,stroke:#333,stroke-width:2px,color:#fff
    style Vercel fill:#000,stroke:#333,stroke-width:2px,color:#fff
    style Render fill:#4A4A4A,stroke:#333,stroke-width:2px,color:#fff
    style Neon fill:#22A56A,stroke:#333,stroke-width:2px,color:#fff
```

-----

### 1\. é¡¹ç›®åˆå§‹åŒ–ä¸ç¯å¢ƒå‡†å¤‡

#### 1.1. å·¥å…·å®‰è£…

ç¡®ä¿æ‚¨çš„ç”µè„‘å·²å®‰è£…ä»¥ä¸‹è½¯ä»¶ï¼š

  * [Git](https://git-scm.com/)
  * [Node.js](https://nodejs.org/en) (å»ºè®®ä½¿ç”¨ v18 æˆ–æ›´é«˜ç‰ˆæœ¬)
  * [Docker Desktop](https://www.docker.com/products/docker-desktop/)
  * [Cursor IDE](https://cursor.sh/)

#### 1.2. è´¦å·æ³¨å†Œ

æ‚¨éœ€è¦æ³¨å†Œä»¥ä¸‹å¹³å°çš„è´¦å·ï¼š

  * [GitHub](https://github.com/): ç”¨äºä»£ç æ‰˜ç®¡å’Œ CI/CD è§¦å‘ã€‚
  * [Vercel](https://vercel.com/): ç”¨äºéƒ¨ç½²å‰ç«¯ã€‚
  * [Render](https://render.com/): ç”¨äºéƒ¨ç½²åç«¯ã€‚
  * [Neon](https://neon.tech/): ç”¨äºæä¾› PostgreSQL æ•°æ®åº“ã€‚
  * [Google AI Studio](https://aistudio.google.com/): ç”¨äºè·å– Gemini API Keyã€‚
  * [Cloudinary](https://cloudinary.com/) (å¯é€‰): å¦‚æœéœ€è¦æ”¯æŒæ–‡ä»¶ä¸Šä¼ ï¼Œæ³¨å†Œæ­¤è´¦å·ã€‚

#### 1.3. é¡¹ç›®ç»“æ„æ­å»º

1.  åœ¨æœ¬åœ°åˆ›å»ºä¸€ä¸ªé¡¹ç›®æ€»æ–‡ä»¶å¤¹ï¼Œä¾‹å¦‚ `smart-quiz`ã€‚
2.  åœ¨ Cursor ä¸­æ‰“å¼€è¯¥æ–‡ä»¶å¤¹ã€‚
3.  åˆ›å»º `backend` å’Œ `frontend` ä¸¤ä¸ªå­æ–‡ä»¶å¤¹ã€‚
4.  åˆå§‹åŒ– Git ä»“åº“:
    ```bash
    git init
    echo "node_modules\n.env\n.next\nbuild\n" > .gitignore
    ```

-----

### 2\. æœ¬åœ°æ²‰æµ¸å¼å¼€å‘ç¯å¢ƒé…ç½®

æˆ‘ä»¬å°†ä½¿ç”¨ Docker åœ¨æœ¬åœ°è¿è¡Œ Strapi å’Œ PostgreSQLï¼Œå®ç°ä¸çº¿ä¸Šç¯å¢ƒä¸€è‡´çš„åç«¯ä½“éªŒã€‚

#### 2.1. é…ç½®åç«¯ (Strapi + PostgreSQL)

1.  åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `docker-compose.yml` æ–‡ä»¶ï¼š
    ```yaml
    version: '3.8'
    services:
      # PostgreSQL æ•°æ®åº“æœåŠ¡
      db:
        image: postgres:15-alpine
        container_name: smartquiz_db
        environment:
          POSTGRES_USER: ${DATABASE_USER:-strapi}
          POSTGRES_PASSWORD: ${DATABASE_PASSWORD:-strapi}
          POSTGRES_DB: ${DATABASE_NAME:-strapi}
        volumes:
          - ./db_data:/var/lib/postgresql/data
        ports:
          - "5432:5432"
        restart: unless-stopped

      # Strapi åç«¯æœåŠ¡
      backend:
        build: ./backend  # æŒ‡å®š Strapi ä»£ç ç›®å½•
        container_name: smartquiz_backend
        environment:
          DATABASE_CLIENT: ${DATABASE_CLIENT:-postgres}
          DATABASE_HOST: db  # Docker å†…éƒ¨ç½‘ç»œä¸»æœºå
          DATABASE_PORT: ${DATABASE_PORT:-5432}
          DATABASE_NAME: ${DATABASE_NAME:-strapi}
          DATABASE_USERNAME: ${DATABASE_USER:-strapi}
          DATABASE_PASSWORD: ${DATABASE_PASSWORD:-strapi}
          JWT_SECRET: ${JWT_SECRET} # ç”Ÿäº§ç¯å¢ƒä¸­åŠ¡å¿…ä¿®æ”¹
          ADMIN_JWT_SECRET: ${ADMIN_JWT_SECRET} # ç”Ÿäº§ç¯å¢ƒä¸­åŠ¡å¿…ä¿®æ”¹
          API_TOKEN_SALT: ${API_TOKEN_SALT}
        volumes:
          - ./backend:/opt/app # å°†æœ¬åœ° backend ç›®å½•æŒ‚è½½åˆ°å®¹å™¨ä¸­ï¼Œå®ç°çƒ­æ›´æ–°
        ports:
          - "1337:1337"
        depends_on:
          - db
        restart: unless-stopped

    volumes:
      db_data:
    ```
2.  åœ¨ `backend` æ–‡ä»¶å¤¹ä¸­åˆ›å»º Strapi é¡¹ç›®ï¼š
    ```bash
    cd backend
    npx create-strapi-app@latest . --quickstart --no-run
    # å®‰è£… pg é©±åŠ¨
    npm install pg
    cd ..
    ```
3.  åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `.env` æ–‡ä»¶ï¼Œç”¨äºå­˜æ”¾æœ¬åœ°å¼€å‘å¯†é’¥ï¼š
    ```env
    # Strapi & PostgreSQL
    DATABASE_USER=strapi
    DATABASE_PASSWORD=strapi
    DATABASE_NAME=strapi
    JWT_SECRET=a_very_secret_jwt_for_local_dev
    ADMIN_JWT_SECRET=a_very_secret_admin_jwt_for_local_dev
    API_TOKEN_SALT=a_random_salt_for_local_dev
    ```

#### 2.2. å¯åŠ¨æœ¬åœ°ç¯å¢ƒ

1.  **å¯åŠ¨åç«¯**: åœ¨é¡¹ç›®æ ¹ç›®å½•çš„ Cursor ç»ˆç«¯ä¸­è¿è¡Œï¼š
    ```bash
    docker-compose up -d
    ```
    é¦–æ¬¡å¯åŠ¨ä¼šéœ€è¦ä¸€äº›æ—¶é—´æ¥ä¸‹è½½é•œåƒå’Œæ„å»ºã€‚æˆåŠŸåï¼Œæ‚¨çš„ Strapi åç«¯å°†åœ¨ `http://localhost:1337` è¿è¡Œã€‚
2.  **å¯åŠ¨å‰ç«¯**:
      * é¦–å…ˆåˆ›å»º Next.js é¡¹ç›®ï¼š
        ```bash
        cd frontend
        npx create-next-app@latest . --typescript --tailwind --eslint --app --src-dir --import-alias "@/*"
        cd ..
        ```
      * åœ¨ `frontend` ç›®å½•çš„ Cursor ç»ˆç«¯ä¸­è¿è¡Œï¼š
        ```bash
        npm run dev
        ```
      * æ‚¨çš„ Next.js å‰ç«¯å°†åœ¨ `http://localhost:3000` è¿è¡Œã€‚

ç°åœ¨ï¼Œæ‚¨å·²ç»æ‹¥æœ‰äº†ä¸€ä¸ªå®Œæ•´çš„æœ¬åœ°å¼€å‘ç¯å¢ƒï¼Œå¯ä»¥åœ¨ Cursor ä¸­åŒæ—¶ä¿®æ”¹å‰åç«¯ä»£ç å¹¶ç«‹å³çœ‹åˆ°æ•ˆæœã€‚

-----

### 3\. åç«¯å¼€å‘ (Strapi)

è®¿é—® `http://localhost:1337/admin` åˆ›å»ºæ‚¨çš„ç¬¬ä¸€ä¸ªç®¡ç†å‘˜è´¦æˆ·ã€‚

#### 3.1. Content-Type (æ¨¡å‹) è®¾è®¡

åœ¨ Strapi ç®¡ç†åå°çš„ "Content-Type Builder" ä¸­åˆ›å»ºä»¥ä¸‹æ¨¡å‹ï¼š

  * **Quiz (é¢˜åº“)**

      * `title` (Text, Required)
      * `description` (Text)
      * `owner` (Relation: Quiz `has one` User)
      * `questions` (Relation: Quiz `has many` Questions)

  * **Question (é¢˜ç›®)**

      * `question_text` (Long Text, Required)
      * `options` (JSON, optional)
      * `answer` (Long Text, Required)
      * `type` (Enumeration: `single_choice`, `multiple_choice`, `short_answer`)
      * `quiz` (Relation: Question `belongs to one` Quiz)

  * **User (å†…ç½®)**

      * åœ¨å†…ç½®çš„ User æ¨¡å‹ä¸­æ·»åŠ ä¸€ä¸ªå­—æ®µ `gemini_api_key` (Text, private)ã€‚

#### 3.2. æ ¸å¿ƒ API å¼€å‘ï¼šæ™ºèƒ½è§£ææ¥å£

1.  **åˆ›å»ºè‡ªå®šä¹‰è·¯ç”±**: åœ¨ `backend/src/api/` ä¸‹åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶å¤¹ `quiz-parser`ï¼Œå¹¶åœ¨å…¶ä¸­åˆ›å»º `routes` å’Œ `controllers` æ–‡ä»¶å¤¹ã€‚
2.  **ç¼–å†™ Controller é€»è¾‘**: åœ¨ `controllers/quiz-parser.js` ä¸­ç¼–å†™æ ¸å¿ƒé€»è¾‘ã€‚
    ```javascript
    // backend/src/api/quiz-parser/controllers/quiz-parser.js
    const { GoogleGenerativeAI } = require("@google/generative-ai");

    module.exports = {
      async parse(ctx) {
        const { id: userId } = ctx.state.user; // è·å–å½“å‰ç™»å½•ç”¨æˆ·ID
        const { rawText } = ctx.request.body; // è·å–å‰ç«¯ä¼ æ¥çš„é¢˜åº“æ–‡æœ¬

        if (!rawText) {
          return ctx.badRequest('Raw text is missing.');
        }

        // 1. ä»æ•°æ®åº“è·å–ç”¨æˆ·çš„API Key (æ³¨æ„ï¼šå®é™…é¡¹ç›®ä¸­åº”åŠ å¯†å­˜å‚¨å’Œè§£å¯†ä½¿ç”¨)
        const user = await strapi.entityService.findOne('plugin::users-permissions.user', userId);
        if (!user.gemini_api_key) {
          return ctx.badRequest('Gemini API Key is not configured.');
        }

        // 2. è°ƒç”¨ Gemini API
        try {
          const genAI = new GoogleGenerativeAI(user.gemini_api_key);
          const model = genAI.getGenerativeModel({ model: "gemini-pro" });

          const prompt = `
            You are an expert at parsing raw text into structured JSON data. Analyze the following text which contains a list of questions and answers. Your task is to convert it into a JSON array. Each object in the array should represent a single question and must have the following fields: "question_text", "options" (as an array of strings if it's a multiple-choice question, otherwise an empty array), "answer", and "type" (detect if it is 'single_choice', 'multiple_choice', or 'short_answer').

            Here is the text:
            ---
            ${rawText}
            ---

            Provide ONLY the JSON output, without any surrounding text or markdown formatting.
          `;

          const result = await model.generateContent(prompt);
          const response = await result.response;
          const jsonText = response.text();
          const questions = JSON.parse(jsonText);

          // 3. å°†è§£æç»“æœå­˜å…¥æ•°æ®åº“
          const newQuiz = await strapi.service('api::quiz.quiz').create({
            data: {
              title: 'æ–°è§£æçš„é¢˜åº“', // å¯è®©ç”¨æˆ·è‡ªå®šä¹‰
              owner: userId,
              publishedAt: new Date().toISOString(),
            },
          });

          for (const q of questions) {
            await strapi.service('api::question.question').create({
              data: {
                ...q,
                quiz: newQuiz.id,
                publishedAt: new Date().toISOString(),
              }
            });
          }

          return { quiz: newQuiz };

        } catch (error) {
          console.error(error);
          return ctx.internalServerError('Failed to parse quiz.', { error: error.message });
        }
      },
    };
    ```
3.  **é…ç½®è·¯ç”±å’Œæƒé™**:
      * åˆ›å»º `routes/quiz-parser.js` æ–‡ä»¶ï¼Œå®šä¹‰ `POST /quiz-parser/parse` è·¯ç”±ã€‚
      * åœ¨ Strapi ç®¡ç†åå°çš„ `Settings -> Roles -> Authenticated` ä¸­ï¼Œä¸º `Quiz-parser` çš„ `parse` action å‹¾é€‰æƒé™ã€‚

#### 3.3 RESTful API è§„æ ¼

ä¸‹è¡¨æ¦‚è§ˆæ‰€æœ‰æ ¸å¿ƒæ¥å£ï¼ˆ`BASE_URL` é»˜è®¤ä¸º `http://localhost:1337/api`ï¼Œç”Ÿäº§ç¯å¢ƒè¯·æ›¿æ¢ä¸º Render åŸŸåï¼‰ï¼š

| æ¨¡å— | Path | Method | æè¿° | è®¤è¯ |
|------|------|--------|------|------|
| **Auth** | `/auth/local/register` | POST | é‚®ç®±æ³¨å†Œ | æ—  |
| | `/auth/local` | POST | é‚®ç®±ç™»å½• | æ—  |
| | `/auth/forgot-password` | POST | å¿˜è®°å¯†ç ï¼ˆå‘é€é‚®ä»¶ï¼‰ | æ—  |
| | `/auth/reset-password` | POST | é‡ç½®å¯†ç  | æ—  |
| **User** | `/users/me` | GET | å½“å‰ç”¨æˆ·ä¿¡æ¯ | Bearer |
| | `/users/me` | PUT | æ›´æ–°ç”¨æˆ·ï¼ˆå« `gemini_api_key`ï¼‰ | Bearer |
| **Quiz** | `/quizzes` | POST | æ–°å»ºç©ºé¢˜åº“ | Bearer |
| | `/quizzes` | GET | æˆ‘çš„é¢˜åº“åˆ—è¡¨ | Bearer |
| | `/quizzes/:id` | GET | é¢˜åº“è¯¦æƒ…ï¼ˆå« questionsï¼‰ | Bearer |
| | `/quizzes/:id` | DELETE | åˆ é™¤é¢˜åº“ | Bearer |
| **Quiz-Parser** | `/quiz-parser/parse` | POST | **æ™ºèƒ½è§£æåŸæ–‡å¹¶ç”Ÿæˆé¢˜åº“** | Bearer |
| **Question** | `/questions/:id/submit` | POST | è®°å½•å•é¢˜ä½œç­”ç»“æœ | Bearer |
| **Progress** | `/progress` | GET | å­¦ä¹ ç»Ÿè®¡ï¼ˆé¢˜åº“ç»´åº¦ï¼‰ | Bearer |

---

##### 3.3.1 è®¤è¯æ¨¡å—

###### 1) POST `/auth/local/register` â€“ æ³¨å†Œ

````http
POST {{BASE_URL}}/auth/local/register
Content-Type: application/json

{
  "username": "Alice",
  "email": "alice@example.com",
  "password": "P@ssw0rd123"
}
````

æˆåŠŸè¿”å› `200 OK`ï¼š

```json
{
  "jwt": "<token>",
  "user": {
    "id": 1,
    "username": "Alice",
    "email": "alice@example.com"
  }
}
```

###### 2) POST `/auth/local` â€“ ç™»å½•

```http
POST {{BASE_URL}}/auth/local
Content-Type: application/json

{
  "identifier": "alice@example.com",
  "password": "P@ssw0rd123"
}
```

è¿”å›å­—æ®µä¸æ³¨å†Œç›¸åŒã€‚

###### 3) POST `/auth/forgot-password` â€“ å¿˜è®°å¯†ç 

Bodyï¼š`{ "email": "alice@example.com" }`ï¼ŒæˆåŠŸè¿”å› `200 OK`ï¼ˆStrapi å°†å‘é‚®ç®±å‘é€é‡ç½®é“¾æ¥ï¼‰ã€‚

###### 4) POST `/auth/reset-password` â€“ é‡ç½®å¯†ç 

```http
POST {{BASE_URL}}/auth/reset-password
{
  "code": "<urlParamCode>",
  "password": "NewP@ss1",
  "passwordConfirmation": "NewP@ss1"
}
```

---

##### 3.3.2 ç”¨æˆ·æ¨¡å—

###### GET `/users/me` â€“ è·å–å½“å‰ç”¨æˆ·

Headersï¼š`Authorization: Bearer <jwt>`

```json
{
  "id": 1,
  "username": "Alice",
  "email": "alice@example.com",
  "gemini_api_key": "sk-****"
}
```

###### PUT `/users/me` â€“ æ›´æ–°ç”¨æˆ·

```http
PUT {{BASE_URL}}/users/me
Authorization: Bearer <jwt>

{
  "username": "Alice",
  "gemini_api_key": "AIza..."
}
```

---

##### 3.3.3 é¢˜åº“æ¨¡å—

###### POST `/quizzes` â€“ åˆ›å»ºç©ºé¢˜åº“

```http
POST {{BASE_URL}}/quizzes
Authorization: Bearer <jwt>

{
  "title": "é«˜ç­‰æ•°å­¦é¢˜åº“",
  "description": "ç« èŠ‚ä¸€ï½å››"
}
```

è¿”å›ï¼š`{ "id": 12, "title": "é«˜ç­‰æ•°å­¦é¢˜åº“", ... }`

###### GET `/quizzes` â€“ æˆ‘çš„é¢˜åº“åˆ—è¡¨

ç¤ºä¾‹ï¼š`GET /quizzes?filters[owner][$eq]=me&sort=createdAt:desc` è¿”å›é¢˜åº“æ•°ç»„ã€‚

###### POST `/quiz-parser/parse` â€“ æ™ºèƒ½è§£æ

```http
POST {{BASE_URL}}/quiz-parser/parse
Authorization: Bearer <jwt>

{
  "rawText": "1. ..........\nA) ...\nB) ...\nã€‚C) ...\n..."
}
```

æˆåŠŸè¿”å›ï¼š`{ "quiz": { "id": 15, "title": "æ–°è§£æçš„é¢˜åº“" } }`ã€‚

###### DELETE `/quizzes/:id` â€“ åˆ é™¤é¢˜åº“

`DELETE /quizzes/15` â†’ è¿”å› `204 No Content`ã€‚

---

##### 3.3.4 é¢˜ç›®ä¸è¿›åº¦æ¨¡å—

###### POST `/questions/:id/submit` â€“ æäº¤å•é¢˜ç»“æœ

```http
POST /questions/88/submit
Authorization: Bearer <jwt>

{
  "isCorrect": true,
  "userAnswer": "d/dx(xÂ²) = 2x"
}
```

è¿”å›ï¼š`201 Created`ï¼Œbody å«è¿›åº¦è®°å½•å¯¹è±¡ã€‚

###### GET `/progress?quizId=15` â€“ è·å–é¢˜åº“è¿›åº¦

```json
{
  "quizId": 15,
  "total": 96,
  "correct": 74,
  "accuracy": 0.771
}
```

> **é”™è¯¯ç ç»Ÿä¸€çº¦å®š**ï¼š
> * `400` å‚æ•°ç¼ºå¤± / æ ¼å¼ä¸åˆæ³•
> * `401` æœªè®¤è¯æˆ– `jwt` è¿‡æœŸ
> * `403` æƒé™ä¸è¶³ï¼ˆé owner æ“ä½œï¼‰
> * `404` èµ„æºä¸å­˜åœ¨
> * `500` æœåŠ¡å™¨å†…éƒ¨é”™è¯¯

---

### 4\. å‰ç«¯å¼€å‘ (Next.js)

#### 4.1. ç¯å¢ƒå˜é‡

åœ¨ `frontend/` ç›®å½•ä¸‹åˆ›å»º `.env.local` æ–‡ä»¶ï¼š

```env
NEXT_PUBLIC_STRAPI_API_URL=http://localhost:1337
```

#### 4.2. æ ¸å¿ƒé¡µé¢å¼€å‘

åˆ©ç”¨æ‚¨åœ¨ `v0.dev` ä¸­ç”Ÿæˆçš„ç»„ä»¶ï¼Œå¼€å§‹æ·»åŠ ä¸šåŠ¡é€»è¾‘ã€‚

  * **è®¤è¯æµç¨‹**:
      * åˆ›å»ºä¸€ä¸ª `lib/auth.js` æˆ–ç±»ä¼¼æ–‡ä»¶ï¼Œå°è£…ä¸ Strapi `POST /api/auth/local` æ¥å£çš„äº¤äº’ã€‚
      * ç™»å½•æˆåŠŸåï¼Œå°†è¿”å›çš„ `jwt` å­˜å‚¨åˆ° `httpOnly` Cookie ä¸­ã€‚
  * **API Key é…ç½®é¡µé¢**:
      * åˆ›å»ºä¸€ä¸ªè¡¨å•ï¼Œ`onSubmit` æ—¶å‘åç«¯çš„è‡ªå®šä¹‰æ¥å£ï¼ˆä¾‹å¦‚ `PUT /api/users/me`ï¼‰å‘é€è¯·æ±‚ï¼Œæ›´æ–° `gemini_api_key` å­—æ®µã€‚
  * **é¢˜åº“åˆ›å»ºé¡µé¢**:
      * æ”¾ç½®ä¸€ä¸ª `<textarea>` å’Œä¸€ä¸ªæŒ‰é’®ã€‚
      * ç‚¹å‡»æŒ‰é’®æ—¶ï¼Œè°ƒç”¨åç«¯åˆ›å»ºçš„ `POST /api/quiz-parser/parse` æ¥å£ï¼Œå¹¶å°† `textarea` çš„å†…å®¹ä½œä¸º `rawText` å‘é€ã€‚
  * **åˆ·é¢˜é¡µé¢ (`/quiz/[id]`)**:
      * è¿™æ˜¯ä¸€ä¸ªåŠ¨æ€è·¯ç”±é¡µé¢ã€‚
      * ä½¿ç”¨ `useSWR` æˆ– `React Query` ä» Strapi è·å– `/api/quizzes/[id]?populate=questions` çš„æ•°æ®ã€‚
      * å°†è·å–åˆ°çš„é¢˜ç›®æ•°æ®æ¸²æŸ“æˆäº¤äº’å¼å¡ç‰‡ã€‚

#### 4.3. ç»Ÿä¸€å¸ƒå±€ä¸ä¾§è¾¹æ è®¾è®¡

æœ¬é¡¹ç›®é‡‡ç”¨ **Next.js 15 App Router** çš„ _layout.tsx_ ä¸ _slot_ ç‰¹æ€§ï¼Œå®ç°å‰ç«¯é¡µé¢çš„ç»Ÿä¸€å£³ï¼ˆShellï¼‰å¸ƒå±€ï¼Œä¿è¯å·¦/å³ä¾§è¾¹æ åœ¨å„é¡µé¢é—´ä¿æŒçŠ¶æ€ä¸ä¸¢å¤±ã€‚

  * **æ•´ä½“ç»“æ„**:
    ```tsx
    // frontend/src/app/(dashboard)/layout.tsx
    <html>
      <body className="flex h-screen overflow-hidden">
        <LeftSidebar />      {/* é¢˜åº“ä¸Šä¼ ä¸å†å²è®°å½• */}
        <main className="flex-1 overflow-y-auto">{children}</main>
        <RightSidebar />     {/* Gemini Key é…ç½®ã€è´¦å·ä¿¡æ¯ */}
      </body>
    </html>
    ```
  * **LeftSidebar**: åŒ…å«â€œä¸Šä¼ é¢˜åº“â€æŒ‰é’®ã€`MyQuizzes` å†å²åˆ—è¡¨ã€ä»¥åŠè·³è½¬åˆ°é¦–é¡µ/ä¸ªäººä¸­å¿ƒçš„å¯¼èˆªã€‚
  * **RightSidebar**: æä¾› `GeminiApiKeyForm`ã€å½“å‰ç™»å½•ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ã€`LogoutButton` ç­‰ã€‚
  * **æ ·å¼**: ä½¿ç”¨ Tailwind `w-64` å›ºå®šå®½åº¦ä¾§è¾¹æ ï¼›ç§»åŠ¨ç«¯é€šè¿‡éšè—/æŠ½å±‰å¼å¼¹å‡ºè§£å†³ã€‚

#### 4.4. ç”¨æˆ·è®¤è¯ä¸é‚®ç®±æ‰¾å›

åˆ©ç”¨ **Strapi Users & Permissions Plugin** åŸç”Ÿæ¥å£ï¼Œå®Œæˆé‚®ç®±æ³¨å†Œã€ç™»å½•ã€å¿˜è®°å¯†ç åŠé€€å‡ºç™»å½•ã€‚

  * **æ³¨å†Œ / ç™»å½•é¡µé¢** (`/auth/[type]`):
      * `type` å–å€¼ `register | login`ï¼Œç»“åˆ `server actions` è°ƒç”¨ `POST /api/auth/local` æˆ– `.../register`ã€‚
      * æˆåŠŸåï¼Œå°† `jwt` å†™å…¥ **httpOnly Cookie** (`set-cookie`)ï¼Œå¹¶åœ¨ `RightSidebar` å±•ç¤ºç”¨æˆ·é‚®ç®±ã€‚
  * **å¿˜è®°å¯†ç ** (`/auth/forgot-password`):
      * è¡¨å•æäº¤é‚®ç®±åˆ° `POST /api/auth/forgot-password`ã€‚
      * Strapi éœ€åœ¨ `config/plugins.js` ä¸­é…ç½®é‚®ä»¶æœåŠ¡å•†ï¼ˆå¦‚ SendGridï¼‰ã€‚
  * **é‡ç½®å¯†ç **: é“¾æ¥è·³è½¬åˆ° `/auth/reset-password?code=xxx`ï¼Œè°ƒç”¨ `POST /api/auth/reset-password` å®Œæˆã€‚
  * **é€€å‡ºç™»å½•**: `LogoutButton` æ¸…é™¤ `jwt` Cookieï¼Œå¹¶é‡å®šå‘åˆ°ç™»å½•é¡µã€‚

#### 4.5. é¢˜åº“ä¸Šä¼ ä¸å†å²è®°å½•

  * **UploadQuizForm** (ä½äº `LeftSidebar`):
      * æ”¯æŒæ‹–æ‹½æˆ–ç‚¹å‡»ä¸Šä¼ æœ¬åœ°æ–‡ä»¶ï¼ˆWord/CSV/çº¯æ–‡æœ¬ï¼‰ã€‚
      * è¯»å–æ–‡ä»¶å†…å®¹åï¼Œé€šè¿‡ `POST /api/quiz-parser/parse` å‘é€è‡³åç«¯ï¼Œå¹¶åœ¨æˆåŠŸå›è°ƒä¸­ä½¿ç”¨ `router.push('/quiz/' + quiz.id)` è·³è½¬åˆ·é¢˜é¡µã€‚
  * **MyQuizzes** åˆ—è¡¨: 
      * SWR è¯·æ±‚ `/api/quizzes?filters[owner][$eq]=me&populate=count.questions`ï¼Œå±•ç¤ºå·²ä¸Šä¼ é¢˜åº“æ ‡é¢˜ã€é¢˜ç›®æ•°é‡ã€åˆ›å»ºæ—¥æœŸã€‚
      * ç‚¹å‡»åˆ—è¡¨é¡¹ç›´æ¥è·³è½¬ç›¸åº”åˆ·é¢˜é¡µï¼›æ”¯æŒåˆ é™¤ï¼ˆè°ƒç”¨ `DELETE /api/quizzes/:id`ï¼‰ã€‚

#### 4.6. åˆ·é¢˜é€»è¾‘ä¸äº¤äº’å®ç°

åˆ·é¢˜é¡µé¢éœ€å®Œå…¨éµå¾ªç”¨æˆ·æä¾›çš„ **interactionFlow** è§„èŒƒï¼Œå®ç°é¢˜åºé€‰æ‹©ã€å®æ—¶åˆ¤é¢˜ã€å¯¼èˆªä¸ç»“æœç»Ÿè®¡ã€‚

  1. **é¦–æ¬¡åŠ è½½**: é¡µé¢æ¸²æŸ“ â€œé¡ºåº / éšæœºâ€ é€‰æ‹©å¯¹è¯ï¼Œå­˜å…¥ `state.questionOrder` åæ‰åŠ è½½é¢˜åº“æ•°æ®ã€‚
  2. **é¢˜ç›®æ¸²æŸ“**: `QuestionCard` ç»„ä»¶æ ¹æ® `type` æ¸²æŸ“é€‰æ‹©é¢˜æŒ‰é’®æˆ–å¡«ç©ºè¾“å…¥æ¡†ï¼›ç­”æ¡ˆéªŒè¯é€»è¾‘åœ¨å®¢æˆ·ç«¯å®Œæˆã€‚
  3. **çŠ¶æ€æŒä¹…åŒ–**: ä½¿ç”¨ `useLocalStorage` Hook ä¿å­˜ç”¨æˆ·ä½œç­”è®°å½• `{ [questionId]: { answer, correct } }`ï¼Œç¡®ä¿åˆ·æ–°/åˆ‡é¢˜ä¸ä¸¢æ•°æ®ã€‚
  4. **å¯¼èˆªæ **: é¢˜å·æŒ‰é’®æ ¹æ®ä½œç­”çŠ¶æ€åº”ç”¨ `bg-blue-500 / bg-green-500 / bg-red-500` é¢œè‰²ã€‚
  5. **å®Œæˆç»ƒä¹ **: ç»Ÿè®¡æ­£ç¡®ç‡åè·³è½¬åˆ° `/quiz/[id]/result`ï¼Œæ˜¾ç¤ºåˆ†æ•°å¹¶æä¾›â€œé‡æ–°å¼€å§‹â€æŒ‰é’®ã€‚

#### 4.7 å‰ç«¯ä¸‹ä¸€æ­¥ä¼˜åŒ– & åç»­åŠŸèƒ½è·¯çº¿

> æœ¬èŠ‚æ—¨åœ¨æ¢³ç†å½“å‰ MVP å®Œæˆååº”å°½å¿«è¿­ä»£çš„ä½“éªŒä¼˜åŒ–ç‚¹ï¼Œä»¥åŠä¸­é•¿æœŸåŠŸèƒ½è§„åˆ’ï¼Œç¡®ä¿å›¢é˜Ÿæœ‰æ¸…æ™°çš„ Roadmapã€‚

**A. è¿‘æœŸä¼˜åŒ–æ¸…å•ï¼ˆSprint 1~2ï¼‰**

| ä¼˜å…ˆçº§ | ä¼˜åŒ–é¡¹ | ç›®æ ‡ & æ–¹æ¡ˆ |
|---------|--------|-------------|
| ğŸ”¥ High | è®¤è¯å®‰å…¨ | â€¢ `httpOnly + Secure` Cookie æŒä¹…åŒ– `jwt`ï¼Œé˜²æ­¢ XSS.<br/>â€¢ æ–°å¢ `/api/auth/refresh` æ¥å£ï¼Œå‰ç«¯é™é»˜ç»­ç­¾ï¼Œé¿å… Session å¤±æ•ˆå¼¹çª—ã€‚ |
| ğŸ”¥ High | API Layer | â€¢ æ–°å»º `src/lib/api.ts`ï¼Œå°è£… `fetcher`ï¼Œè‡ªåŠ¨æ³¨å…¥ Tokenã€ç»Ÿä¸€å¼‚å¸¸ Toast.<br/>â€¢ å…¨ç«™ä½¿ç”¨ **React Query**ï¼Œç™»å½• / ç™»å‡ºæ—¶è°ƒç”¨ `queryClient.clear()`. |
| ğŸ”¥ High | è§£æè¿›åº¦ | â€¢ åç«¯ `quiz-parser` æ­é… `bullmq`/`agenda` å…¥é˜Ÿï¼Œè¿”å› `jobId`ã€‚<br/>â€¢ `/quiz-parser/status/:jobId` è½®è¯¢ â†’ â€œè§£æè¿›åº¦æ¡â€ã€‚ |
| â­ Medium | é¢˜åº“äº‘ç«¯åŒæ­¥ | â€¢ æäº¤ç­”æ¡ˆæ—¶è°ƒç”¨ `/questions/:id/submit`ï¼›ç¦»çº¿å†™ `localStorage`ï¼Œ`navigator.onLine` æ¢å¤åæ‰¹é‡è¡¥ä¼ ã€‚ |
| â­ Medium | ç§»åŠ¨ç«¯é€‚é… | â€¢ ä¾§è¾¹æ æ”¹ `Sheet` (Radix)ï¼›æŒ‰é’®å¯ç‚¹å‡»é¢ç§¯ â‰¥44pxï¼›åº•éƒ¨å¯¼èˆªæ”¯æŒæ¨ªå‘æ»šåŠ¨ & è½»æ‰«åˆ‡é¢˜ã€‚ |
| â­ Medium | å¯è®¿é—®æ€§ | â€¢ æ‰€æœ‰è¡¨å•æ§ä»¶è¡¥ `aria-label`ã€`aria-describedby`ï¼›å¯¹æ¯”åº¦è¾¾ WCAG AAã€‚ |
| â­ Medium | æ€§èƒ½ | â€¢ `dynamic()` æ‡’åŠ è½½å¤§ç»„ä»¶ï¼›Tailwind `content` æŒ‡å‘ `src/**`ï¼›å¼€å¯ `swcMinify`ã€‚ |
| ğŸ“ Low | æ—¥å¿—ç›‘æ§ | â€¢ é›†æˆ Sentry (æµè§ˆå™¨ + Node) & Logtailï¼›Render æ‰“å¼€æ¯æ—¥ DB å¤‡ä»½ã€‚ |

**B. ä¸­é•¿æœŸåŠŸèƒ½è·¯çº¿ï¼ˆQ2~Q3ï¼‰**

1. ç¬¬ä¸‰æ–¹ç™»å½•ï¼šGitHub / å¾®ä¿¡ OAuthï¼Œæé«˜æ³¨å†Œè½¬åŒ–ç‡ã€‚
2. é¢˜åº“å…±äº«å¸‚åœºï¼šç”¨æˆ·å¯å…¬å¼€é¢˜åº“ï¼ŒæŒ‰æ ‡ç­¾æœç´¢ & æ”¶è—ã€‚
3. é”™é¢˜æœ¬ï¼šè‡ªåŠ¨å°† `isCorrect=false` é¢˜ç›®æ±‡æ€»ï¼Œå¯å®šæ—¶å¤ä¹ ã€‚
4. AI è§£æƒ‘ï¼šç­”é”™åè°ƒç”¨ Gemini ç”Ÿæˆè§£ææ€è·¯ã€‚
5. å¤ä¹ è®¡åˆ’ï¼šæ ¹æ®è‰¾å®¾æµ©æ–¯é—å¿˜æ›²çº¿æ¨é€é‚®ä»¶ / é€šçŸ¥ã€‚
6. å¤šäººåä½œï¼šSmall team å…±ç”¨é¢˜åº“ï¼Œæˆå‘˜æˆç»©æ’è¡Œã€‚
7. Reporting Dashboardï¼šRecharts ç»Ÿè®¡æ­£ç¡®ç‡è¶‹åŠ¿ / çƒ­åŠ›å›¾ã€‚

> **è¯´æ˜**ï¼šä»¥ä¸Šä¼˜å…ˆçº§å¯æ ¹æ®ç”¨æˆ·åé¦ˆé€‚æ—¶è°ƒæ•´ï¼›æ¯ä¸ª Feature å‡éœ€å¯¹åº”åç«¯æƒé™ & æ•°æ®æ¨¡å‹å˜æ›´ã€‚

> **æ³¨æ„**: æ•´é¡µéœ€åœ¨å•ä¸ªæ–‡ä»¶ä¸­å®Œæˆé™æ€æ‰“åŒ…ä»…é€‚ç”¨äºç¦»çº¿å¯¼å‡ºåœºæ™¯ã€‚å®é™… Next.js é¡µé¢åº”æŒ‰ç»„ä»¶æ‹†åˆ†ä»¥å……åˆ†åˆ©ç”¨æ¡†æ¶ä¼˜åŠ¿ï¼Œä¸Šè¿°è¦æ±‚å¯åœ¨ `export-to-single-html` åŠŸèƒ½ä¸­å†è¡Œå¤„ç†ã€‚

-----

### 5\. éƒ¨ç½²ä¸Šçº¿

#### 5.1. éƒ¨ç½²åç«¯åˆ° Render

1.  ç™»å½• Renderï¼Œæ–°å»ºä¸€ä¸ª "Web Service"ã€‚
2.  è¿æ¥æ‚¨çš„ GitHub ä»“åº“ã€‚
3.  **é…ç½®**:
      * **Root Directory**: `./backend`
      * **Build Command**: `npm install && npm run build`
      * **Start Command**: `npm run start`
4.  **æ·»åŠ ç¯å¢ƒå˜é‡**:
      * ä» Neon Dashboard è·å–æ‚¨çš„æ•°æ®åº“è¿æ¥ URLï¼Œå¹¶å°†å…¶æ·»åŠ åˆ° Render çš„ `DATABASE_URL` ç¯å¢ƒå˜é‡ä¸­ã€‚
      * æ·»åŠ æ‚¨åœ¨ Strapi ä¸­ä½¿ç”¨çš„å…¶ä»–æ‰€æœ‰ç¯å¢ƒå˜é‡ï¼Œä¾‹å¦‚ `JWT_SECRET`, `ADMIN_JWT_SECRET` ç­‰ï¼ˆ**è¯·åŠ¡å¿…ä½¿ç”¨å®‰å…¨çš„éšæœºå­—ç¬¦ä¸²ï¼Œä¸è¦ç”¨æœ¬åœ°çš„å€¼**ï¼‰ã€‚
      * Render ä¼šè‡ªåŠ¨åˆ†é…ä¸€ä¸ªåŸŸåç»™æ‚¨ï¼Œä¾‹å¦‚ `your-backend.onrender.com`ã€‚

#### 5.2. éƒ¨ç½²å‰ç«¯åˆ° Vercel

1.  ç™»å½• Vercelï¼Œæ–°å»ºä¸€ä¸ªé¡¹ç›®ã€‚
2.  è¿æ¥æ‚¨çš„ GitHub ä»“åº“ã€‚
3.  **é…ç½®**:
      * Vercel ä¼šè‡ªåŠ¨è¯†åˆ«ä¸º Next.js é¡¹ç›®ï¼Œå¹¶è®¾ç½®å¥½æ„å»ºå‘½ä»¤ã€‚
      * **Root Directory**: `./frontend`
4.  **æ·»åŠ ç¯å¢ƒå˜é‡**:
      * æ·»åŠ  `NEXT_PUBLIC_STRAPI_API_URL`ï¼Œå€¼æ˜¯æ‚¨åˆšåˆšåœ¨ Render ä¸Šéƒ¨ç½²çš„åç«¯åŸŸåï¼Œä¾‹å¦‚ `https://your-backend.onrender.com`ã€‚
5.  ç‚¹å‡»éƒ¨ç½²ã€‚

-----

### 6\. å¼€å‘å·¥ä½œæµæ€»ç»“

1.  **è·å–æœ€æ–°ä»£ç **: `git pull`
2.  **å¯åŠ¨æœ¬åœ°ç¯å¢ƒ**: `docker-compose up -d` & åœ¨ `frontend` ç›®å½•è¿è¡Œ `npm run dev`ã€‚
3.  **å¼€å‘æ–°åŠŸèƒ½**: åœ¨ Cursor ä¸­ç¼–ç ï¼Œåˆ©ç”¨ AI è¾…åŠ©ã€‚
4.  **æäº¤ä»£ç **: `git add .`, `git commit -m "feat: xxx"`, `git push`ã€‚
5.  **è‡ªåŠ¨éƒ¨ç½²**: Vercel å’Œ Render ä¼šè‡ªåŠ¨æ£€æµ‹åˆ°ä»£ç å˜æ›´ï¼Œå¹¶å¼€å§‹éƒ¨ç½²æ–°ç‰ˆæœ¬ã€‚
6.  **å®Œæˆ**: å–æ¯å’–å•¡ï¼Œç­‰å¾…éƒ¨ç½²å®Œæˆï¼Œçº¿ä¸ŠåŠŸèƒ½æ›´æ–°ã€‚

è¿™ä»½æ–‡æ¡£ä¸ºæ‚¨æä¾›äº†ä»0åˆ°1çš„å®Œæ•´è·¯å¾„ã€‚ç¥æ‚¨å¼€å‘é¡ºåˆ©ï¼