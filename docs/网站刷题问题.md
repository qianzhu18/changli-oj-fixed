## 题库转网页（刷题）：问题澄清与AI执行流程

### 当前真实状态
- 现状：我们已能从上传文件中“提取纯文本字符”，但未完成“从文本中自动识别多道题目并生成可刷题HTML网页”的步骤。
- 缺口：
  1) 未将原始文本解析为结构化题目集（题干、选项/答案、类型）；
  2) 未根据解析结果生成“单文件HTML”刷题页；
  3) 未实现“点击后反馈正确答案、锁定作答、状态持久化、随机出题”等交互逻辑。

### 目标与产出
- 目标：把用户上传的题库文件，自动转换为“可刷题”的单个HTML文件（内含HTML/CSS/JS），在手机端优先显示良好。
- 产出：一个自包含的 .html 文件，命名规则：<原文件名>-quiz.html。
- 出题顺序：必须先询问用户“顺序/随机”，再按选择生成（详见交互流程）。

### 输入说明（文件与数据）
- 文件来源：用户上传的 Word/PDF/TXT/CSV 等题库文件。
- 识别规则（借鉴并沿用 /Users/mac/千逐数字资产/刷题网站开发/题库转换prompt.md）：
  - 题目结构：
    - 选择题：题干 + 紧随其后的四个选项为一题；
    - 填空题：题干 + 对应答案为一题。
  - 正确答案识别（选择题）：源文档中“正确选项所在行”行首有一个句号“。”，该项即为正确答案；生成网页时去掉此句号。
  - 选项展示：不使用 A/B/C/D 标签，保持文档顺序。
  - 编号：网页题号从 1 开始连续编号。
  - 复杂内容：解析器必须正确处理被双引号包裹且可能包含逗号、换行、引号的字段，保留原始格式（用于代码/缩进显示）。

### 题型自动判断
- 当数据呈“两列（题干, 答案）”→ 判定为填空题；
- 当数据呈“题干 + 多个选项（且包含正确标记）”→ 判定为选择题；
- 一个文件内仅一种题型；若混合出现，以识别比例最高的类型为主，无法归类的条目置入“未解析”列表。

### 交互流程（严格遵循）
- 第一步（必须先执行，仅一句话）：
  您好！在为您生成刷题网页之前，请问您希望题目是按顺序出还是随机出？
- 第二步（仅当已获得“顺序/随机”答案且已上传文件后执行）：
  按下述规则解析题库并生成单文件HTML。

### 随机模式的唯一序列规则
- 若用户选择“随机”：
  1) 在生成前先一次性打乱整个题库，得到新的固定随机序列；
  2) 页面上所有编号（如“1/96”）、上一题/下一题、底部题号栏，均以该序列为唯一依据；
  3) 原始位置不再影响任何导航或编号。

### 生成网页的功能要求
- 展示方式：一次只显示一道题。
- 选择题反馈：
  - 点击选项即时反馈：对→绿色高亮；错→所选项红色高亮；
  - 作答后锁定本题所有选项，不可更改。
- 填空题反馈：
  - 提供文本输入框 + “提交答案”按钮；
  - 校验规则：与标准答案“完全一致”（大小写、空格、标点均需匹配）；
  - 提交后锁定输入；对→边框绿色；错→边框红色，并显示“正确答案：XXX”。
- 状态持久化：切换题目来回，作答状态与内容不丢失（存于页面内存）。
- 导航：支持“上一题/下一题”与底部“可横向滚动”的题号栏；题号颜色含义：当前题（蓝）、答对（绿）、答错（红）。
- 完成页：提供“完成练习”按钮，显示“答对题数/总题数（正确率%）”，并可“重新开始”。
- 视觉与技术：
  - 单文件内置 HTML/CSS/JS；
  - 样式建议用 Tailwind CSS；
  - 移动端优先；
  - 所有状态更新需静态即时完成，不使用任何过渡动画。

### 解析与容错（前端优先、可降级）
- 优先按照 /Users/mac/千逐数字资产/刷题网站开发/题库转换prompt.md 的解析规则；
- 若文件结构不规范：
  - 尝试使用启发式拆题：按空行/编号/常见选项前缀等切分；
  - 无法确定正确项时，将该题标记“待确认”，但仍生成可浏览的题目卡片；
  - 任何无法解析的行，归入“未解析”列表，置于HTML末尾供人工复核；
  - 始终以“先出界面可用”为原则，保证页面可浏览与作答（符合前端优先策略）。

### AI执行步骤（面向实现）
1) 收集用户选择：仅提出并获取“顺序/随机”。
2) 载入题库文件：识别文件类型（DOCX/PDF/TXT/CSV）。
3) 解析：
   - 若CSV：实现“带引号字段”的安全解析，保留换行与引号；
   - 若DOCX/PDF/TXT：按“题干+选项/答案”模式抽取，识别“。”标记；
   - 产出结构化列表：[{ id, stem, options?, answer, type }...]。
4) 题型判定与清洗：统一为选择题或填空题；剔除空白/噪声条目。
5) 排序：依据“顺序/随机”的规则得到最终序列。
6) 生成单文件HTML：嵌入题集与交互脚本、样式（Tailwind）；禁用动画。
7) 自检清单：
   - 编号与导航一致；随机序列全局一致；
   - 选择题点击后锁定；填空题提交后锁定；
   - 正确/错误高亮与统计准确；
   - 底部题号栏可滑动并正确着色；
   - 未解析列表存在且可见（如有）；
   - 手机端视口显示正常。
8) 输出：生成 <原文件名>-quiz.html。

### 验收标准（最小可用）
- 同一文件内的多道题被正确识别并逐题展示；
- 点击（或提交）后能得到正确/错误反馈且不可重复作答；
- 导航、编号、结果统计、重开功能完整；
- 随机模式下，序列唯一且全局一致；
- 解析困难时，页面仍可用，未解析项被清单化展示。

### 参考规范
- 规范来源文件：/Users/mac/千逐数字资产/刷题网站开发/题库转换prompt.md（本页已提炼其核心约束）。
- 交互守则：未完成“第一步问询”前，严禁直接生成页面。

### 后续可迭代项（可选）
- 题库管理、错题本、导入导出、图片/音视频题、云同步、I18N 等。
