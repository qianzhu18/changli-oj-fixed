# 智能题库系统优化方案

> 更新时间：2025-04-XX  作者：千逐

## 一、优化背景

1. **界面风格割裂**
   - 现行应用使用 `study-app` 目录下的旧 UI（以下简称 *旧 UI*）。
   - 新设计稿已在 `study-app（新UI）` 目录（以下简称 *新 UI*）实现，视觉与交互更为现代。
   - 登录页与登录后主界面风格不一致，影响体验。

2. **功能交互不完善**
   - “联系作者 / 打赏作者” 当前需要上传图片，步骤繁琐且体验不佳。

## 二、优化目标

| 编号 | 目标描述 |
| ---- | -------------------------------- |
| G1   | 全面替换旧 UI，统一采用 *新 UI* 视觉风格与组件库。 |
| G2   | 登录页、仪表盘及所有二级页面保持一致的 “墨隐侠踪” 主题。 |
| G3   | “联系作者” 点击后直接弹出 `个人微信联系方式.jpg`。 |
| G4   | “打赏作者” 点击后弹出二维码列表，展示 `微信支付.jpg` 与 `支付宝支付.jpg`。 |
| G5   | 替换过程保持后端接口、业务逻辑完全兼容，不影响已有数据与功能。 |

## 三、改造范围

1. **前端目录调整**
   - `study-app` 👉 归档（可重命名为 `study-app-old` 保留备份）。
   - `study-app（新UI）` 👉 重命名为 `study-app` 作为新的前端根目录。

2. **公共样式与主题**
   - 核心样式集中在 `app/globals.css`，已覆盖暗黑模式、墨隐侠踪自定义组件类。
   - 需复用并在登录后页面中引入。确保 `layout.tsx` 统一注入字体与 ThemeProvider。

3. **页面/组件迁移**
   - 登录流程：`SwordsmanIntro` → `InkWashLogin` → `MainDashboard`。
   - 主仪表盘：`MainDashboard` 下 `Header`、`LeftSidebar`、`RightContent` 等。
   - 复用所有 `ui/*` 通用组件。

4. **新增/调整交互**
   - ContactAuthorDialog：在任意页面可调用，展示 `个人微信联系方式.jpg`。
   - DonationDialog：展示两个支付二维码（微信 & 支付宝），支持左右切换或并排显示。

## 四、实施步骤

1. **目录替换**
   ```bash
   mv study-app study-app-old   # 备份旧 UI
   mv "study-app（新UI）" study-app
   ```

2. **配置同步**
   - 合并 `package.json` 依赖，优先保留 *新 UI* 版本，补充旧 UI 中仍在使用的库。
   - 重新执行 `pnpm install` / `npm install`。

3. **路由与入口调整**
   - Next.js 项目结构已符合新版约定，无需特殊修改。
   - 确保 `next.config.mjs`、`tailwind.config.ts` 中路径、别名无旧目录引用。

4. **功能组件开发**

   ### 4.1 联系作者弹窗（ContactAuthorDialog）
   - 位置：`components/contact-author-dialog.tsx`（新增）。
   - 调用统一 `Dialog` 组件；内部 `<img src="/个人微信联系方式.jpg" />`。
   - 在 `Header` 或需要的页面注入触发按钮。

   ### 4.2 打赏作者弹窗（DonationDialog）
   - 位置：`components/donation-dialog.tsx`（新增，已存在简版待完善）。
   - 弹窗内容：两张二维码并排/轮播显示。
     ```tsx
     <img src="/微信支付.jpg" className="w-40" />
     <img src="/支付宝支付.jpg" className="w-40" />
     ```
   - 可使用 `Tabs` 或 `Carousel` 实现切换。

5. **主题一致性检查**
   - 在 `app/layout.tsx` 中全局引用 `globals.css`，并包裹 `<ThemeProvider>`。
   - 登录页、仪表盘等页面顶部不再单独引入额外样式。

6. **回归测试**
   - ✅ 页面跳转流程：开屏动画 → 登录/注册 → Dashboard。
   - ✅ 响应式：手机、平板、桌面。
   - ✅ 暗黑模式手动切换验证。
   - ✅ Contact & Donation 弹窗显示正确图片，无上传入口。
   - ✅ 无 404 资源缺失。

## 五、风险评估与缓解

| 风险 | 等级 | 缓解措施 |
| ---- | ---- | -------------------------------------------- |
| 样式覆盖冲突 | 中 | 使用 PostCSS/Tailwind 前缀或 BEM 命名规约，逐页排查。 |
| 依赖版本不兼容 | 中 | 分步升级，锁定版本；CI 跑完整单测与构建。 |
| 图片路径错误 | 低 | 资源置于 `public/` 目录，运行时自动映射为根路径。 |

## 六、交付物

1. **新的前端代码目录** `study-app/`
2. **新增组件** `contact-author-dialog.tsx`、`donation-dialog.tsx`
3. **优化文档**（本文档）
4. **更新后的 README.md**（项目根目录）

## 七、时间排期（T+N）

| 日期 | 任务 |
| ---- | ---- |
| T+0 | 目录备份与替换、依赖合并 |
| T+1 | 联系作者弹窗开发 & 测试 |
| T+2 | 打赏作者弹窗开发 & 测试 |
| T+3 | 风格统一 & 全站排查 |
| T+4 | 回归测试、Bug Fix |
| T+5 | 发布 & 版本 Tag |

---

> 如有新增需求或变更，请在 **T+2** 前反馈，以便同步调整排期。
