下面给出一套“后端重构 + Git 管理”完整方案，满足

1) 继续使用现有 Next.js（study-app）前端界面，**UI 不改动**；  
2) 后端迁移到更轻量、易部署、免费额度友好的架构；  
3) 全程用 GitHub 私有仓库托管，便于版本控制与 CI/CD。

────────────────────────────────────────
一、核心思路总览
────────────────────────────────────────
1. 单体 Express → **Serverless/BFF 一体化**  
   • 把 backend 目录里的业务逻辑逐步迁入 Next.js 的 **API Route / Server Action**，前后端同仓库、同部署。  
   • 删除独立 Node 服务器，减少运维 & 费用。

2. 运行时选择  
   • 部署：**Vercel Free / Cloudflare Pages Functions** 均可，推荐 Vercel（原生支持 Next.js）。  
   • Runtime：对计算密集或 AI 调用使用 Vercel Serverless Function；普通 CRUD 可用 Edge Runtime（超快、按请求计费）。

3. 数据层  
   • 继续用 Prisma，但把 SQLite dev.db 换成 **Neon Postgres Free**（500 MB）。  
   • `.env` 中配置 `DATABASE_URL`，Vercel 环境变量托管。

4. AI 调用 & 文件解析  
   • aiService、fileParserService 等迁入 `/app/api/ai/...`、`/app/api/parse-quiz/...`。  
   • 对外 URL 不变，前端 fetch 地址无需改。  
   • 大文件上传仍可用 Next.js 13 / 14 的 `app/api/upload` + `NextResponse.json()`。

5. 版本控制 / CI  
   • GitHub 私有仓库 → 关联 Vercel。  
   • main / dev 分支模型；通过 PR 合并上主干触发 Vercel 预览部署。  
   • 可选 GitHub Actions 运行 `pnpm test`。

────────────────────────────────────────
二、落地步骤
────────────────────────────────────────
Step 0 初始化 Git
```bash
cd /Users/.../刷题网站开发
git init
git add .
git commit -m "chore: initial monorepo code import"
git remote add origin git@github.com:YOUR_NAME/quiz-app.git
git push -u origin main
```

Step 1 在 Vercel 创建新项目  
• 选择 GitHub 私有仓库 → Framework = Next.js → Root Dir = `study-app`  
• 设置环境变量  
  - DATABASE_URL  
  - OPENAI_API_KEY / GOOGLE_GEMINI_KEY …  
• 首次 `Deploy`。

Step 2 数据迁移  
1. Neon 创建数据库 → 得到连接串；复制到 `.env`。  
2. 修改 `prisma/schema.prisma`  
   ```prisma
   datasource db {
     provider = "postgresql"
     url      = env("DATABASE_URL")
   }
   ```  
3. `pnpm prisma migrate reset --skip-generate` 重新生成表。  

Step 3 迁移 API
示例：把 `backend/src/routes/quizRoutes.ts` → `study-app/app/api/quiz/route.ts`
```ts
// app/api/quiz/route.ts
import { NextRequest, NextResponse } from 'next/server';
import { getQuizById } from '@/server/quizService';

export async function GET(req: NextRequest) {
  const id = req.nextUrl.searchParams.get('id');
  if (!id) return NextResponse.json({ error: 'id required' }, { status: 400 });
  const quiz = await getQuizById(id);
  return NextResponse.json({ quiz });
}
```
• 公用业务逻辑放 `study-app/server/` 文件夹，避免和前端混淆。  
• 依次迁移 auth、practice、ai、upload 等，其余 Express 中间件（authV2、validation）可写成 `middleware.ts`。

Step 4 删除旧 backend 目录（迁移完成后）  
• 先重命名为 `backend-legacy` 保存一周；确认无误后 `git rm -r backend-legacy`.

Step 5 Git 工作流
```
main   – 生产
dev    – 日常开发
feature/* – 单个功能
hotfix/*  – 生产紧急修复
```
• PR 模板中要求：描述、截图、Checklist。  
• 合并到 main 自动触发 Vercel Production Deploy；其余分支触发 Preview。

────────────────────────────────────────
三、后续优化
────────────────────────────────────────
1. **API 版本控制**：Next.js 内部目录即可分 v1/v2。  
2. **队列任务**：若有耗时任务（解析大文件、AI 生成），用 Vercel Cron + Upstash QStash。  
3. **缓存**：读操作可接 Cloudflare KV 或 Vercel KV（免费额度充足）。  
4. **监控**：接入 Vercel Analytics（免费 10 GB/月）或 Sentry Free Plan。

────────────────────────────────────────
四、风险与注意
────────────────────────────────────────
• Vercel Free 日请求 >100 万 或执行时间 >100 小时会限速 —— 可切 Cloudflare Workers。  
• Serverless 函数内不要持久化连接池，Prisma 需 `prisma@5` + `accelerate` 或短连接模式。  
• AI Key 勿写死在代码；放入 Vercel Secrets。  
• 上传文件大小受 Vercel 限制（4 MB Edge / 100 MB Serverless）。大文件可直传 S3 兼容存储。

────────────────────────────────────────
五、小结
────────────────────────────────────────
通过“**Next.js 单仓库 + Serverless API**”方案，可：

• 减少双端维护成本  
• 利用 Vercel 免费额度一键部署  
• 保持前端 UI 完全不变  
• GitHub 私有仓库实现安全、可审计的版本管理

按上述步骤逐步迁移，即可在 1-2 天内完成后端重构。祝开发顺利！