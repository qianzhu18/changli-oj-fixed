<!-- Generated by SpecStory -->

# æ›´æ¢åç«¯æ¶æ„å»ºè®® (2025-07-25 15:40Z)

_**User**_

æˆ‘éœ€è¦ä½ ç”¨gitç®¡ç†ä¹‹å‰çš„æ–¹æ¡ˆï¼Œæˆ‘### 1. æŠ€æœ¯é€‰å‹ (Tech Stack Selection) ğŸ’»ğŸ§ ğŸ’¡

- **åç«¯æˆæœ¬æœ€ä½æ–¹æ¡ˆï¼š** Node.js
    - åŸå› ï¼šå¯è½»æ¾æ”¹é€ æˆ Serverless Function (æ— æœåŠ¡å™¨å‡½æ•°)ã€‚
    - å…è´¹éƒ¨ç½²å¹³å°ï¼šCloudflare Worker, Vercel, Netlifyã€‚
- **å‰ç«¯é€‰å‹ï¼š** å¯¹éƒ¨ç½²æˆæœ¬å½±å“å°ï¼Œé€‰æ‹©å–œæ¬¢çš„å³å¯ã€‚
    - æ¨èï¼šReact (åç»­å¯æ‰©å±•åˆ° React Nativeï¼Œå®ç°è·¨ç«¯æ‰‹æœºåº”ç”¨)ã€‚
    - **ç»„åˆæ–¹æ¡ˆï¼š** Node.js + React (å¾ˆè‡ªç„¶åœ°ä¼šæƒ³åˆ° Next.js)ã€‚
- **Next.jsï¼š**
    - åœ¨æµ·å¤–ååˆ†æµè¡Œçš„å¼€å‘æ¡†æ¶ã€‚
    - å…·å¤‡ SEO å‹å¥½çš„ç‰¹ç‚¹ï¼Œæ˜“è¢«æœç´¢å¼•æ“æ”¶å½•ã€‚
    - ç»“åˆäº† Client (å®¢æˆ·ç«¯) å’Œ Server (æœåŠ¡å™¨) ç«¯æ¸²æŸ“ã€‚
    - **æœ¬æ¬¡é¡¹ç›®ï¼š** çˆ¬çˆ¬è™¾å¯¹ Next.js ä¸å¤ªç†Ÿæ‚‰ï¼Œä¸»è¦äº¤ç”± AI å®Œæˆå¼€å‘ä»»åŠ¡ã€‚æƒ³ä½¿ç”¨è¿™ä¸ªå¼€å‘æ¶æ„ï¼Œå€ŸåŠ©å…è´¹æœåŠ¡æ¥å®Œæˆä»»åŠ¡ï¼Œæˆ‘è§‰å¾—ç°åœ¨çš„æ¶æ„éš¾ä»¥å®ç°ï¼Œè¯·æ›´æ¢æˆ‘çš„åç«¯æ¶æ„ï¼Œä½†æ˜¯ä¸è¦æ”¹å˜å‰ç«¯ç•Œé¢é˜…è¯»ä¸‹é¢çš„å¼€å‘æ¡†æ¶å»ºè®®@çˆ¬çˆ¬è™¾å¼€å‘æ–¹æ¡ˆå»ºè®®.md 

---

_**Assistant**_

<think><details><summary>Thought Process</summary>**Considering architecture options**

It looks like there's an existing study app built with Next.js, and there's a backend folder involved. I'm thinking about combining things. One option is to integrate the backend logic into Next.js through server actions or API routes, which simplifies architecture into a monorepo. I should identify essential features like quiz parsing and user authentication. For a minimal MVP, I could implement basic endpoints for parsing quizzes and user login. Alternatively, I could use Cloudflare workers to deploy Express. Let's sketch out a clear explanation and provide actionable steps!</details></think>

---

ä¸‹é¢ç»™å‡ºä¸€å¥—â€œåç«¯é‡æ„ + Git ç®¡ç†â€å®Œæ•´æ–¹æ¡ˆï¼Œæ»¡è¶³

1) ç»§ç»­ä½¿ç”¨ç°æœ‰ Next.jsï¼ˆstudy-appï¼‰å‰ç«¯ç•Œé¢ï¼Œ**UI ä¸æ”¹åŠ¨**ï¼›  
2) åç«¯è¿ç§»åˆ°æ›´è½»é‡ã€æ˜“éƒ¨ç½²ã€å…è´¹é¢åº¦å‹å¥½çš„æ¶æ„ï¼›  
3) å…¨ç¨‹ç”¨ GitHub ç§æœ‰ä»“åº“æ‰˜ç®¡ï¼Œä¾¿äºç‰ˆæœ¬æ§åˆ¶ä¸ CI/CDã€‚

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ä¸€ã€æ ¸å¿ƒæ€è·¯æ€»è§ˆ
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. å•ä½“ Express â†’ **Serverless/BFF ä¸€ä½“åŒ–**  
   â€¢ æŠŠ backend ç›®å½•é‡Œçš„ä¸šåŠ¡é€»è¾‘é€æ­¥è¿å…¥ Next.js çš„ **API Route / Server Action**ï¼Œå‰åç«¯åŒä»“åº“ã€åŒéƒ¨ç½²ã€‚  
   â€¢ åˆ é™¤ç‹¬ç«‹ Node æœåŠ¡å™¨ï¼Œå‡å°‘è¿ç»´ & è´¹ç”¨ã€‚

2. è¿è¡Œæ—¶é€‰æ‹©  
   â€¢ éƒ¨ç½²ï¼š**Vercel Free / Cloudflare Pages Functions** å‡å¯ï¼Œæ¨è Vercelï¼ˆåŸç”Ÿæ”¯æŒ Next.jsï¼‰ã€‚  
   â€¢ Runtimeï¼šå¯¹è®¡ç®—å¯†é›†æˆ– AI è°ƒç”¨ä½¿ç”¨ Vercel Serverless Functionï¼›æ™®é€š CRUD å¯ç”¨ Edge Runtimeï¼ˆè¶…å¿«ã€æŒ‰è¯·æ±‚è®¡è´¹ï¼‰ã€‚

3. æ•°æ®å±‚  
   â€¢ ç»§ç»­ç”¨ Prismaï¼Œä½†æŠŠ SQLite dev.db æ¢æˆ **Neon Postgres Free**ï¼ˆ500 MBï¼‰ã€‚  
   â€¢ `.env` ä¸­é…ç½® `DATABASE_URL`ï¼ŒVercel ç¯å¢ƒå˜é‡æ‰˜ç®¡ã€‚

4. AI è°ƒç”¨ & æ–‡ä»¶è§£æ  
   â€¢ aiServiceã€fileParserService ç­‰è¿å…¥ `/app/api/ai/...`ã€`/app/api/parse-quiz/...`ã€‚  
   â€¢ å¯¹å¤– URL ä¸å˜ï¼Œå‰ç«¯ fetch åœ°å€æ— éœ€æ”¹ã€‚  
   â€¢ å¤§æ–‡ä»¶ä¸Šä¼ ä»å¯ç”¨ Next.js 13 / 14 çš„ `app/api/upload` + `NextResponse.json()`ã€‚

5. ç‰ˆæœ¬æ§åˆ¶ / CI  
   â€¢ GitHub ç§æœ‰ä»“åº“ â†’ å…³è” Vercelã€‚  
   â€¢ main / dev åˆ†æ”¯æ¨¡å‹ï¼›é€šè¿‡ PR åˆå¹¶ä¸Šä¸»å¹²è§¦å‘ Vercel é¢„è§ˆéƒ¨ç½²ã€‚  
   â€¢ å¯é€‰ GitHub Actions è¿è¡Œ `pnpm test`ã€‚

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
äºŒã€è½åœ°æ­¥éª¤
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Step 0 åˆå§‹åŒ– Git
```bash
cd /Users/.../åˆ·é¢˜ç½‘ç«™å¼€å‘
git init
git add .
git commit -m "chore: initial monorepo code import"
git remote add origin git@github.com:YOUR_NAME/quiz-app.git
git push -u origin main
```

Step 1 åœ¨ Vercel åˆ›å»ºæ–°é¡¹ç›®  
â€¢ é€‰æ‹© GitHub ç§æœ‰ä»“åº“ â†’ Framework = Next.js â†’ Root Dir = `study-app`  
â€¢ è®¾ç½®ç¯å¢ƒå˜é‡  
  - DATABASE_URL  
  - OPENAI_API_KEY / GOOGLE_GEMINI_KEY â€¦  
â€¢ é¦–æ¬¡ `Deploy`ã€‚

Step 2 æ•°æ®è¿ç§»  
1. Neon åˆ›å»ºæ•°æ®åº“ â†’ å¾—åˆ°è¿æ¥ä¸²ï¼›å¤åˆ¶åˆ° `.env`ã€‚  
2. ä¿®æ”¹ `prisma/schema.prisma`  
   ```prisma
   datasource db {
     provider = "postgresql"
     url      = env("DATABASE_URL")
   }
   ```  
3. `pnpm prisma migrate reset --skip-generate` é‡æ–°ç”Ÿæˆè¡¨ã€‚  

Step 3 è¿ç§» API
ç¤ºä¾‹ï¼šæŠŠ `backend/src/routes/quizRoutes.ts` â†’ `study-app/app/api/quiz/route.ts`
```ts
// app/api/quiz/route.ts
import { NextRequest, NextResponse } from 'next/server';
import { getQuizById } from '@/server/quizService';

export async function GET(req: NextRequest) {
  const id = req.nextUrl.searchParams.get('id');
  if (!id) return NextResponse.json({ error: 'id required' }, { status: 400 });
  const quiz = await getQuizById(id);
  return NextResponse.json({ quiz });
}
```
â€¢ å…¬ç”¨ä¸šåŠ¡é€»è¾‘æ”¾ `study-app/server/` æ–‡ä»¶å¤¹ï¼Œé¿å…å’Œå‰ç«¯æ··æ·†ã€‚  
â€¢ ä¾æ¬¡è¿ç§» authã€practiceã€aiã€upload ç­‰ï¼Œå…¶ä½™ Express ä¸­é—´ä»¶ï¼ˆauthV2ã€validationï¼‰å¯å†™æˆ `middleware.ts`ã€‚

Step 4 åˆ é™¤æ—§ backend ç›®å½•ï¼ˆè¿ç§»å®Œæˆåï¼‰  
â€¢ å…ˆé‡å‘½åä¸º `backend-legacy` ä¿å­˜ä¸€å‘¨ï¼›ç¡®è®¤æ— è¯¯å `git rm -r backend-legacy`.

Step 5 Git å·¥ä½œæµ
```
main   â€“ ç”Ÿäº§
dev    â€“ æ—¥å¸¸å¼€å‘
feature/* â€“ å•ä¸ªåŠŸèƒ½
hotfix/*  â€“ ç”Ÿäº§ç´§æ€¥ä¿®å¤
```
â€¢ PR æ¨¡æ¿ä¸­è¦æ±‚ï¼šæè¿°ã€æˆªå›¾ã€Checklistã€‚  
â€¢ åˆå¹¶åˆ° main è‡ªåŠ¨è§¦å‘ Vercel Production Deployï¼›å…¶ä½™åˆ†æ”¯è§¦å‘ Previewã€‚

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ä¸‰ã€åç»­ä¼˜åŒ–
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. **API ç‰ˆæœ¬æ§åˆ¶**ï¼šNext.js å†…éƒ¨ç›®å½•å³å¯åˆ† v1/v2ã€‚  
2. **é˜Ÿåˆ—ä»»åŠ¡**ï¼šè‹¥æœ‰è€—æ—¶ä»»åŠ¡ï¼ˆè§£æå¤§æ–‡ä»¶ã€AI ç”Ÿæˆï¼‰ï¼Œç”¨ Vercel Cron + Upstash QStashã€‚  
3. **ç¼“å­˜**ï¼šè¯»æ“ä½œå¯æ¥ Cloudflare KV æˆ– Vercel KVï¼ˆå…è´¹é¢åº¦å……è¶³ï¼‰ã€‚  
4. **ç›‘æ§**ï¼šæ¥å…¥ Vercel Analyticsï¼ˆå…è´¹ 10 GB/æœˆï¼‰æˆ– Sentry Free Planã€‚

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
å››ã€é£é™©ä¸æ³¨æ„
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ Vercel Free æ—¥è¯·æ±‚ >100 ä¸‡ æˆ–æ‰§è¡Œæ—¶é—´ >100 å°æ—¶ä¼šé™é€Ÿ â€”â€” å¯åˆ‡ Cloudflare Workersã€‚  
â€¢ Serverless å‡½æ•°å†…ä¸è¦æŒä¹…åŒ–è¿æ¥æ± ï¼ŒPrisma éœ€ `prisma@5` + `accelerate` æˆ–çŸ­è¿æ¥æ¨¡å¼ã€‚  
â€¢ AI Key å‹¿å†™æ­»åœ¨ä»£ç ï¼›æ”¾å…¥ Vercel Secretsã€‚  
â€¢ ä¸Šä¼ æ–‡ä»¶å¤§å°å— Vercel é™åˆ¶ï¼ˆ4 MB Edge / 100 MB Serverlessï¼‰ã€‚å¤§æ–‡ä»¶å¯ç›´ä¼  S3 å…¼å®¹å­˜å‚¨ã€‚

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
äº”ã€å°ç»“
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
é€šè¿‡â€œ**Next.js å•ä»“åº“ + Serverless API**â€æ–¹æ¡ˆï¼Œå¯ï¼š

â€¢ å‡å°‘åŒç«¯ç»´æŠ¤æˆæœ¬  
â€¢ åˆ©ç”¨ Vercel å…è´¹é¢åº¦ä¸€é”®éƒ¨ç½²  
â€¢ ä¿æŒå‰ç«¯ UI å®Œå…¨ä¸å˜  
â€¢ GitHub ç§æœ‰ä»“åº“å®ç°å®‰å…¨ã€å¯å®¡è®¡çš„ç‰ˆæœ¬ç®¡ç†

æŒ‰ä¸Šè¿°æ­¥éª¤é€æ­¥è¿ç§»ï¼Œå³å¯åœ¨ 1-2 å¤©å†…å®Œæˆåç«¯é‡æ„ã€‚ç¥å¼€å‘é¡ºåˆ©ï¼

---

